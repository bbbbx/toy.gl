{"version":3,"file":"toygl.esm.min.js","sources":["../src/glUtils.js","../src/defaultValue.js","../src/createContext.js","../src/defined.js","../src/createFramebuffer.js","../src/isPowerOfTwo.js","../src/draw.js","../src/index.js","../src/setState.js","../src/clear.js","../src/isArrayLike.js","../src/createTexture.js","../src/createCubeMap.js"],"sourcesContent":["const global = window;\n\nfunction createProgram(gl, vertexShaderSource, fragmentShaderSource) {\n  const vs = gl.createShader(gl.VERTEX_SHADER);\n  gl.shaderSource(vs, vertexShaderSource);\n  gl.compileShader(vs);\n  \n  const fs = gl.createShader(gl.FRAGMENT_SHADER);\n  gl.shaderSource(fs, fragmentShaderSource);\n  gl.compileShader(fs);\n\n  const program = gl.createProgram();\n  gl.attachShader(program, vs);\n  gl.attachShader(program, fs);\n\n  gl.deleteShader(vs);\n  gl.deleteShader(fs);\n\n  // TODO:\n  // for (const attributeName in attributeLocation) {\n  //   if (Object.hasOwnProperty.call(attributeLocation, attributeName)) {\n  //     const location = attributeLocation[attributeName];\n  //     gl.bindAttribLocation(program, location, attributeName);\n  //   }\n  // }\n\n  gl.linkProgram(program);\n\n  let log = '';\n  if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n    if (!gl.getShaderParameter(fs, gl.COMPILE_STATUS)) {\n      log = gl.getShaderInfoLog(fs);\n      console.error('Fragment shader failed to compiled: ' + log);\n    }\n\n    if (!gl.getShaderParameter(vs, gl.COMPILE_STATUS)) {\n      log = gl.getShaderInfoLog(vs);\n      console.error('Vertex shader failed to compiled: ' + log);\n    }\n\n    log = gl.getProgramInfoLog(program);\n    console.error('Shader program link log: ' + log);\n    throw new Error(info);\n  }\n\n  return program;\n}\n\nfunction setCanvasToDisplaySize(canvas) {\n  const dpr = global.devicePixelRatio;\n  const displayWidth = Math.round(canvas.clientWidth * dpr);\n  const displayHeight = Math.round(canvas.clientHeight * dpr);\n\n  const needResize = canvas.width !== displayWidth ||\n                     canvas.height !== displayHeight;\n\n  if (needResize) {\n    canvas.width = displayWidth;\n    canvas.height = displayHeight;\n  }\n}\n\nfunction validateStencilFunc(func) {\n  func = func.toUpperCase();\n  if (func === 'NEVER' ||\n    func === 'ALWAYS' ||\n    func === 'LESS' ||\n    func === 'LEQUAL' ||\n    func === 'NOTEQUAL' ||\n    func === 'EQUAL' ||\n    func === 'GREATER' ||\n    func === 'GEQUAL'\n  ) {\n    return true;\n  }\n  return false;\n}\n\nfunction validateStencilOp(op) {\n  op = op.toUpperCase();\n  if (op === 'KEEP' ||\n    op === 'ZERO' ||\n    op === 'REPLACE' ||\n    op === 'INCR' ||\n    op === 'DECR' ||\n    op === 'INVERT' ||\n    op === 'INCR_WRAP' ||\n    op === 'DECR_WRAP'\n  ) {\n    return true;\n  }\n  return false;\n}\n\nexport {\n  validateStencilFunc,\n  validateStencilOp,\n  createProgram,\n  setCanvasToDisplaySize,\n};\n","function defaultValue(a, b) {\n  if (a === null || a === undefined) {\n    return b;\n  }\n  return a;\n}\n\ndefaultValue.EMPTY_OBJECT = Object.freeze({});\n\nexport default defaultValue;\n","import { setCanvasToDisplaySize } from \"./glUtils.js\";\nimport defaultValue from './defaultValue.js';\n\nconst global = window;\n\n/**\n * Create an instance of WebGLRenderingContext or WebGL2RenderingContext.\n * @param {Object} contextOptions \n * @param {Boolean} contextOptions.alpha \n * @param {Boolean} contextOptions.depth \n * @param {Boolean} contextOptions.stencil \n * @param {Boolean} contextOptions.antialias \n * @param {Boolean} contextOptions.preserveDrawingBuffer \n * @param {Boolean} contextOptions.premultipliedAlpha \n * @param {Boolean} contextOptions.requireWebgl2 \n * @param {HTMLCanvasElement} contextOptions.canvas \n * @returns \n */\nfunction createContext(contextOptions) {\n  contextOptions = defaultValue(contextOptions, defaultValue.EMPTY_OBJECT);\n\n  let canvas = contextOptions.canvas;\n  if (!canvas) {\n    canvas = global.document.createElement('canvas');\n    canvas.style.width = '100vw';\n    canvas.style.height = '100vh';\n    canvas.style.setProperty('display', 'block');\n    canvas.width = window.innerWidth;\n    canvas.height = window.innerHeight;\n  }\n\n  let gl;\n  if (contextOptions.requireWebgl2) {\n    gl = canvas.getContext('webgl2', contextOptions);\n  } else {\n    gl = canvas.getContext('webgl', contextOptions);\n  }\n\n  return gl;\n};\n\nexport default createContext;\n","function defined(a) {\n  return a !== null && a !== undefined;\n}\n\nexport default defined;\n","const FRAMEBUFFER_STATUS = {\n  36053: 'FRAMEBUFFER_COMPLETE',\n  36054: 'FRAMEBUFFER_INCOMPLETE_ATTACHMENT',\n  36055: 'FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT',\n  36057: 'FRAMEBUFFER_INCOMPLETE_DIMENSIONS',\n  36061: 'FRAMEBUFFER_UNSUPPORTED',\n};\n\nfunction createFramebuffer(gl, options) {\n  const { colorTexture, depthTexture, depthRenderbuffer } = options;\n\n  const fb = gl.createFramebuffer();\n  gl.bindFramebuffer(gl.FRAMEBUFFER, fb);\n\n  // color\n  gl.activeTexture(gl.TEXTURE0);\n  gl.bindTexture(gl.TEXTURE_2D, colorTexture);\n  gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, colorTexture, 0);\n\n  // depth\n  if (depthTexture) {\n    gl.activeTexture(gl.TEXTURE0);\n    gl.bindTexture(gl.TEXTURE_2D, depthTexture);\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.TEXTURE_2D, depthTexture, 0);\n  }\n  else if (depthRenderbuffer) {\n    const renderbuffer = gl.createRenderbuffer();\n    gl.bindRenderbuffer(gl.RENDERBUFFER, renderbuffer);\n    gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, depthRenderbuffer.width, depthRenderbuffer.height);\n    gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, renderbuffer);\n  }\n\n  const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n  if (status !== gl.FRAMEBUFFER_COMPLETE) {\n    throw new Error('createFramebuffer: framebuffer combination is NOT completed! Current status is ' + FRAMEBUFFER_STATUS[status] + '.');\n  }\n\n  return fb;\n}\n\nexport default createFramebuffer;\n","function isPowerOfTwo(value) {\n  return (value & (value - 1)) === 0;\n}\n\nexport default isPowerOfTwo;\n","import isArrayLike from './isArrayLike.js';\nimport defaultValue from './defaultValue.js';\nimport {\n  createProgram,\n  setCanvasToDisplaySize\n} from './glUtils.js';\nimport isPowerOfTwo from './isPowerOfTwo.js';\n\nconst cachedProgram = {};\nconst cachedBuffer = {};\nconst cachedTextures = {};\n\nfunction getAttributeSize(activeAttribute) {\n  const { name, size, type } = activeAttribute;\n  let s = 0;\n  switch (type) {\n    case 5126: // gl.FLOAT\n      s = size * 1;\n      break;\n    case 35664: // gl.FLOAT_VEC2\n      s = 2 * size;\n      break;\n    case 35665: // gl.FLOAT_VEC3\n      s = 3 * size;\n      break;\n    case 35666: // gl.FLOAT_VEC4\n      s = 4 * size;\n      break;\n    case 35674: // gl.FLOAT_MAT2\n      s = 4 * size;\n      break;\n    case 35675: // gl.FLOAT_MAT3\n      s = 9 * size;\n      break;\n    case 35676: // gl.FLOAT_MAT4\n      s = 16 * size;\n      break;\n    default:\n      console.warn('无法识别 attribute ' + name + ' 的类型：' + type);\n  }\n\n  return s;\n}\n\nfunction isArrayBufferView(value) {\n  return value instanceof Float32Array ||\n         value instanceof Uint8Array ||\n         value instanceof Uint16Array ||\n         value instanceof Uint32Array ||\n         value instanceof Int8Array ||\n         value instanceof Int16Array ||\n         value instanceof Int32Array;\n\n}\n\nfunction createAttributeBuffer(gl, typedArray, usage) {\n  const buffer = gl.createBuffer();\n  usage = defaultValue(usage, gl.STATIC_DRAW);\n  gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n  gl.bufferData(gl.ARRAY_BUFFER, typedArray, usage);\n  return buffer;\n};\n\nfunction createIndicesBuffer(gl, typedArray, usage) {\n  const buffer = gl.createBuffer();\n  usage = defaultValue(usage, gl.STATIC_DRAW);\n  gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buffer);\n  gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, typedArray, usage);\n  return buffer;\n};\n\nfunction draw(gl, options) {\n  const { attributes, indices, vs: vsSource, fs: fsSource, count, fb } = options;\n  const primitiveType = defaultValue(options.primitiveType, gl.TRIANGLES);\n  const uniforms = defaultValue(options.uniforms, defaultValue.EMPTY_OBJECT);\n\n  gl.bindFramebuffer(gl.FRAMEBUFFER, fb);\n\n  const key = vsSource + fsSource;\n  let program = cachedProgram[key];\n  if (!program) {\n    program = createProgram(gl, vsSource, fsSource);\n    cachedProgram[key] = program;\n  }\n\n  gl.useProgram(program);\n\n  // attributes\n  const numberOfAttributes = gl.getProgramParameter(program, gl.ACTIVE_ATTRIBUTES);\n  for (let i = 0; i < numberOfAttributes; i++) {\n    const activeAttribute = gl.getActiveAttrib(program, i);\n    const attributeName = activeAttribute.name;\n\n    if (Object.hasOwnProperty.call(attributes, attributeName)) {\n      const attribute = attributes[attributeName];\n      const attribLocation = gl.getAttribLocation(program, attributeName);\n\n      if (attribLocation === -1) {\n        continue;\n      }\n\n      const key = attribute.toString();\n      let buffer = cachedBuffer[key];\n      const size = getAttributeSize(activeAttribute);\n      if (Array.isArray(attribute)) {\n        // const isInteger = Number.isInteger(attribute[0]);\n        // const typedArray = isInteger ? Uint32Array : Float32Array;\n        const typedArray = Float32Array;\n        if (!buffer) {\n          buffer = createAttributeBuffer(gl, new typedArray(attribute));\n          cachedBuffer[key] = buffer;\n        }\n\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n        gl.enableVertexAttribArray(attribLocation);\n        gl.vertexAttribPointer(\n          attribLocation,\n          size,\n          gl.FLOAT,\n          false,\n          0,\n          0\n        );\n      } else if (isArrayBufferView(attribute)) {\n        if (!buffer) {\n          buffer = createAttributeBuffer(gl, attribute);\n          cachedBuffer[key] = buffer;\n        }\n\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n        gl.enableVertexAttribArray(attribLocation);\n        gl.vertexAttribPointer(\n          attribLocation,\n          size,\n          gl.FLOAT,\n          false,\n          0,\n          0\n        );\n      }\n\n    }\n  }\n\n  // uniforms\n  const numberOfUniforms = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);\n  const maximumTextureUnits = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);\n  let currentTextureUnit = 0;\n  for (let i = 0; i < numberOfUniforms; i++) {\n    const activeUniform = gl.getActiveUniform(program, i);\n    const uniformName = activeUniform.name;\n    \n    if (Object.hasOwnProperty.call(uniforms, uniformName)) {\n      const uniform = uniforms[uniformName];\n      const uniformLocation = gl.getUniformLocation(program, uniformName);\n\n      if (uniformLocation === null) {\n        continue;\n      }\n\n      // gl.useProgram(program);\n\n      const typeOfUniform = typeof uniform;\n      const textureUnit = gl.TEXTURE0 + currentTextureUnit;\n      if (uniform instanceof WebGLTexture) {\n        gl.activeTexture(textureUnit);\n\n        if (activeUniform.type === gl.SAMPLER_2D) {\n          gl.bindTexture(gl.TEXTURE_2D, uniform);\n        } else if (activeUniform.type === gl.SAMPLER_CUBE) {\n          gl.bindTexture(gl.TEXTURE_CUBE_MAP, uniform);\n        } else {\n          throw new Error(activeUniform, 'type MUST be SAMPLER_2D or SAMPLER_CUBE');\n        }\n\n        gl.uniform1i(uniformLocation, currentTextureUnit);\n        currentTextureUnit++;\n      } else if (isArrayLike(uniform)) {\n        const size = uniform.length;\n        if (size <= 4) {\n          gl['uniform' + size + 'fv' ](uniformLocation, uniform);\n        } else if (size <= 16) {\n          const order = Math.floor(Math.sqrt(size));\n          const transpose = false; // MUST be false\n          gl['uniformMatrix' + order + 'fv'](uniformLocation, transpose, Array.from(uniform));\n        }\n      } else if (typeOfUniform === 'number') {\n        gl.uniform1f(uniformLocation, uniform);\n      } else if (typeOfUniform === 'string') {\n\n        if (currentTextureUnit > maximumTextureUnits) {\n          console.error('texture exceed maximum texture units.');\n          continue;\n        }\n\n        let texture = cachedTextures[uniform];\n\n        if (!texture) {\n          texture = gl.createTexture();\n          gl.activeTexture(textureUnit);\n          gl.bindTexture(gl.TEXTURE_2D, texture);\n\n          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n\n          gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1, 1, 0, gl.RGBA, gl.UNSIGNED_BYTE, new Uint8Array([255, 255, 255, 255]));\n          const image = new Image();\n          image.src = uniform;\n          image.addEventListener('load', () => {\n            gl.activeTexture(textureUnit);\n            gl.bindTexture(gl.TEXTURE_2D, texture);\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n\n            if (isPowerOfTwo(image.width) && isPowerOfTwo(image.height)) {\n              gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\n              gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\n              gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR);\n              gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n\n              gl.generateMipmap(gl.TEXTURE_2D);\n            }\n          });\n\n          cachedTextures[uniform] = texture;\n        }\n\n        gl.activeTexture(textureUnit);\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        gl.uniform1i(uniformLocation, currentTextureUnit);\n\n        currentTextureUnit++;\n      }\n    }\n  }\n\n  // draw\n  if (indices && indices.length > 0) {\n    let max = Number.MIN_SAFE_INTEGER;\n    for (const index of indices) {\n      max = Math.max(index, max);\n    }\n    let type, typedArray;\n    if (max <= 255) {\n      type = gl.UNSIGNED_BYTE;\n      typedArray = Uint8Array;\n    } else if (max <= 65535) {\n      type = gl.UNSIGNED_SHORT;\n      typedArray = Uint16Array;\n    } else {\n      type = gl.UNSIGNED_INT;\n      typedArray = Uint32Array;\n      gl.getExtension('OES_element_index_unit');\n    }\n\n    const key = indices.toString();\n    let buffer = cachedBuffer[key];\n    if (!buffer) {\n      buffer = createIndicesBuffer(gl, new typedArray(indices));\n      cachedBuffer[key] = buffer;\n    }\n\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buffer);\n    gl.drawElements(primitiveType, count, type, 0);\n  } else {\n    gl.drawArrays(primitiveType, 0, count);\n  }\n\n};\n\nexport default draw;\n","import createContext from './createContext.js';\nimport setState from './setState.js';\nimport createFramebuffer from './createFramebuffer.js';\nimport createTexture from './createTexture.js';\nimport createCubeMap from './createCubeMap.js';\nimport clear from './clear.js';\nimport draw from './draw.js';\n\nconst ToyGL = {\n  createContext,\n  setState,\n  clear,\n  draw,\n  createTexture,\n  createCubeMap,\n  createFramebuffer,\n};\n\nexport default ToyGL;\n","import defined from './defined.js';\nimport {\n  validateStencilFunc,\n  validateStencilOp,\n} from \"./glUtils.js\";\n\nexport default function setState(gl, state) {\n  const { depthTest, stencilTest, colorMask, cull, blend, viewport, scissor } = state;\n\n  if (cull) {\n    if (cull.enable) {\n      gl.enable(gl.CULL_FACE);\n    } else {\n      gl.disable(gl.CULL_FACE);\n    }\n\n    let face = cull.face && cull.face.toUpperCase();\n    if (face && (face === 'BACK' || face === 'FRONT' || face === 'FRONT_AND_BACK')) {\n      gl.cullFace(gl[face]);\n    }\n  }\n\n  if (depthTest) {\n    if (depthTest.enable === true) {\n      gl.enable(gl.DEPTH_TEST);\n    } else if (depthTest.enable === false) {\n      gl.disable(gl.DEPTH_TEST);\n    }\n\n    if (depthTest.func) {\n      const func = depthTest.func.toUpperCase();\n      gl.depthFunc(gl[func]);\n    }\n\n    if (depthTest.write === true) {\n      gl.depthMask(true);\n    } else if (depthTest.write === false) {\n      gl.depthMask(false);\n    }\n  }\n\n  if (stencilTest) {\n    if (stencilTest.enable === true) {\n      gl.enable(gl.STENCIL_TEST);\n    } else if (stencilTest.enable === false) {\n      gl.disable(gl.STENCIL_TEST);\n    }\n\n    if (defined(stencilTest.writeMask)) {\n      gl.stencilMask(stencilTest.writeMask);\n      // gl.stencilMaskSeparate(face, mask);\n    }\n\n    if (defined(stencilTest.func) &&\n      defined(stencilTest.ref) &&\n      defined(stencilTest.readMask)\n    ) {\n      if (validateStencilFunc(stencilTest.func) === false) {\n        throw new Error('setState: stencil func is invalid, current is ' + stencilTest.func + '!');\n      }\n      const func = stencilTest.func.toUpperCase();\n      gl.stencilFunc(gl[func], stencilTest.ref, stencilTest.readMask);\n      // gl.stencilFuncSeparate(face, func, ref, mask)\n    }\n\n    if (defined(stencilTest.fail) &&\n      defined(stencilTest.zfail) &&\n      defined(stencilTest.zpass)\n    ) {\n      if (validateStencilOp(stencilTest.fail) === false ||\n        validateStencilOp(stencilTest.zfail) === false ||\n        validateStencilOp(stencilTest.zpass) === false\n      ) {\n        throw new Error('setState: stencil op is invalid!');\n      }\n      const fail = stencilTest.fail.toUpperCase();\n      const zfail = stencilTest.zfail.toUpperCase();\n      const zpass = stencilTest.zpass.toUpperCase();\n      gl.stencilOp(gl[fail], gl[zfail], gl[zpass]);\n      // gl.stencilOpSeparate(face, fail, zfail, zpass)\n    }\n  }\n\n  if (colorMask) {\n    gl.colorMask(colorMask[0], colorMask[1], colorMask[2], colorMask[3]);\n  }\n\n  if (blend) {\n    if (blend.enable === true) {\n      gl.enable(gl.BLEND)\n    } else if (blend.enable === false) {\n      gl.disable(gl.BLEND)\n    }\n\n    if (blend.blendColor) {\n      gl.blendColor(...blend.blendColor);\n    }\n\n    if (blend.blendEquation) {\n      gl.blendEquation(gl[blend.blendEquation.toUpperCase()]);\n      // gl.blendEquation(modeRGB, modeAlpha)\n    }\n\n    if (blend.blendFunc) {\n      const src = blend.blendFunc[0].toUpperCase();\n      const dst = blend.blendFunc[1].toUpperCase();\n      gl.blendFunc(gl[src], gl[dst]);\n      // gl.blendFuncSeparate(srcRGB, dstRGB, srcAlpha, dstAlpha)\n    }\n  }\n\n  if (viewport) {\n    gl.viewport(viewport[0], viewport[1], viewport[2], viewport[3]);\n  }\n\n  if (scissor) {\n    if (scissor.enable === true) {\n      gl.enable(gl.SCISSOR_TEST);\n    } else if (scissor.enable === false) {\n      gl.disable(gl.SCISSOR_TEST);\n    }\n    const rect = scissor.rect;\n    if (rect) {\n      gl.scissor(rect[0], rect[1], rect[2], rect[3]);\n    }\n  }\n};\n","import defined from './defined.js';\nimport defaultValue from './defaultValue.js';\n\n/**\n * Execute a clear command.\n * @param {WebGLRenderingContext} gl \n * @param {Object} [options] \n * @param {Array} [options.color] \n * @param {Number} [options.depth] \n * @param {Number} [options.stencil] \n * @param {WebGLFramebuffer} [options.fb] \n */\nfunction clear(gl, options) {\n  options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n  const { fb, color, depth, stencil } = options;\n\n  gl.bindFramebuffer(gl.FRAMEBUFFER, fb);\n\n  let mask = 0;\n  if (color) {\n    gl.clearColor(color[0], color[1], color[2], color[3]);\n    mask |= gl.COLOR_BUFFER_BIT;\n  }\n  if (defined(depth)) {\n    gl.clearDepth(depth);\n    mask |= gl.DEPTH_BUFFER_BIT;\n  }\n  if (stencil) {\n    gl.clearStencil(stencil);\n    mask |= gl.STENCIL_BUFFER_BIT;\n  }\n\n  if (mask !== 0) {\n    gl.clear(mask);\n  }\n}\n\nexport default clear;\n","// see https://stackoverflow.com/questions/24048547/checking-if-an-object-is-array-like\nfunction isArrayLike(item) {\n  return (\n    Array.isArray(item) || \n    (!!item &&\n      typeof item === \"object\" &&\n      typeof (item.length) === \"number\" && \n      (item.length === 0 ||\n        (item.length > 0 && \n        (item.length - 1) in item)\n      )\n    )\n  );\n}\n\nexport default isArrayLike;\n","import isPowerOfTwo from './isPowerOfTwo.js';\nimport defined from './defined.js';\n\nfunction createTexture(gl, options) {\n  const { level, internalFormat, type, format, width, height, data, wrapS, wrapT, minFilter, magFilter, generateMipmap } = options;\n  const texture = gl.createTexture();\n\n  gl.activeTexture(gl.TEXTURE0);\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n\n  if (\n    data instanceof HTMLImageElement ||\n    data instanceof HTMLCanvasElement ||\n    data instanceof HTMLVideoElement\n  ) {\n    gl.texImage2D(gl.TEXTURE_2D, level, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, data);\n  } else {\n    const border = 0;\n    gl.texImage2D(gl.TEXTURE_2D, level, internalFormat, width, height, border, format, type, data);\n  }\n\n  // default texture settings\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n\n  if (defined(wrapS)) {\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, wrapS);\n  }\n  if (defined(wrapT)) {\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, wrapT);\n  }\n  if (defined(minFilter)) {\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, minFilter);\n  }\n  if (defined(magFilter)) {\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, magFilter);\n  }\n\n  if (generateMipmap === true) {\n    if (isPowerOfTwo(width) && isPowerOfTwo(height)) {\n      gl.generateMipmap(gl.TEXTURE_2D);\n    } else {\n      console.warn('createTexture: texture size is NOT power of two, current is ' + width + 'x' + height + '.');\n    }\n  }\n\n  return texture;\n}\n\nexport default createTexture;\n","import defaultValue from './defaultValue.js';\n\nfunction createCubeMap(gl, options) {\n  options = defaultValue(options, defaultValue.EMPTY_OBJECT);\n  const level = defaultValue(options.level, 0);\n  const data = options.data;\n  const width = options.width;\n  const height = options.height;\n  const format = defaultValue(options.format, gl.RGBA);\n  const type = defaultValue(options.type, gl.UNSIGNED_BYTE);\n  const internalFormat = defaultValue(options.internalFormat, gl.RGBA);\n\n  const texture = gl.createTexture();\n  gl.activeTexture(gl.TEXTURE0);\n  gl.bindTexture(gl.TEXTURE_CUBE_MAP, texture);\n\n  const faces = [\n    {\n      target: gl.TEXTURE_CUBE_MAP_POSITIVE_X,\n      data: data.px,\n    },\n    {\n      target: gl.TEXTURE_CUBE_MAP_NEGATIVE_X,\n      data: data.nx,\n    },\n    {\n      target: gl.TEXTURE_CUBE_MAP_POSITIVE_Y,\n      data: data.py,\n    },\n    {\n      target: gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,\n      data: data.ny,\n    },\n    {\n      target: gl.TEXTURE_CUBE_MAP_POSITIVE_Z,\n      data: data.pz,\n    },\n    {\n      target: gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,\n      data: data.nz,\n    },\n  ]\n  \n  for (let i = 0; i < 6; i++) {\n    const face = faces[i];\n    const target = face.target;\n    const bufferView = face.data;\n    if (bufferView instanceof HTMLImageElement) {\n      gl.texImage2D(target, level, internalFormat, format, type, bufferView);\n    } else {\n      gl.texImage2D(target, level, internalFormat, width, height, 0, format, type, bufferView);\n    }\n\n    // default texture settings\n    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n  }\n\n  return texture;\n}\n\nexport default createCubeMap;\n"],"names":["validateStencilOp","op","toUpperCase","defaultValue","a","b","EMPTY_OBJECT","Object","freeze","global","window","defined","FRAMEBUFFER_STATUS","36053","36054","36055","36057","36061","isPowerOfTwo","value","cachedProgram","cachedBuffer","cachedTextures","getAttributeSize","activeAttribute","name","size","type","s","console","warn","createAttributeBuffer","gl","typedArray","usage","buffer","createBuffer","STATIC_DRAW","bindBuffer","ARRAY_BUFFER","bufferData","ToyGL","createContext","contextOptions","canvas","document","createElement","style","width","height","setProperty","innerWidth","innerHeight","requireWebgl2","getContext","setState","state","depthTest","stencilTest","colorMask","cull","blend","viewport","scissor","enable","CULL_FACE","disable","face","cullFace","DEPTH_TEST","func","depthFunc","write","depthMask","STENCIL_TEST","writeMask","stencilMask","ref","readMask","validateStencilFunc","Error","stencilFunc","fail","zfail","zpass","stencilOp","BLEND","blendColor","blendEquation","blendFunc","src","dst","SCISSOR_TEST","rect","clear","options","fb","color","depth","stencil","bindFramebuffer","FRAMEBUFFER","mask","clearColor","COLOR_BUFFER_BIT","clearDepth","DEPTH_BUFFER_BIT","clearStencil","STENCIL_BUFFER_BIT","draw","attributes","indices","vs","vsSource","fs","fsSource","count","primitiveType","TRIANGLES","uniforms","key","program","vertexShaderSource","fragmentShaderSource","createShader","VERTEX_SHADER","shaderSource","compileShader","FRAGMENT_SHADER","createProgram","attachShader","deleteShader","linkProgram","log","getProgramParameter","LINK_STATUS","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","error","getProgramInfoLog","info","useProgram","numberOfAttributes","ACTIVE_ATTRIBUTES","i","getActiveAttrib","attributeName","hasOwnProperty","call","attribute","attribLocation","getAttribLocation","toString","Array","isArray","Float32Array","enableVertexAttribArray","vertexAttribPointer","FLOAT","Uint8Array","Uint16Array","Uint32Array","Int8Array","Int16Array","Int32Array","numberOfUniforms","ACTIVE_UNIFORMS","maximumTextureUnits","getParameter","MAX_TEXTURE_IMAGE_UNITS","currentTextureUnit","activeUniform","getActiveUniform","uniformName","uniform","uniformLocation","getUniformLocation","typeOfUniform","textureUnit","TEXTURE0","WebGLTexture","activeTexture","SAMPLER_2D","bindTexture","TEXTURE_2D","SAMPLER_CUBE","TEXTURE_CUBE_MAP","uniform1i","item","length","order","Math","floor","sqrt","transpose","from","uniform1f","texture","createTexture","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","LINEAR","TEXTURE_MAG_FILTER","texImage2D","RGBA","UNSIGNED_BYTE","image","Image","addEventListener","REPEAT","LINEAR_MIPMAP_LINEAR","generateMipmap","max","Number","MIN_SAFE_INTEGER","index","UNSIGNED_SHORT","UNSIGNED_INT","getExtension","ELEMENT_ARRAY_BUFFER","createIndicesBuffer","drawElements","drawArrays","level","internalFormat","format","data","wrapS","wrapT","minFilter","magFilter","HTMLImageElement","HTMLCanvasElement","HTMLVideoElement","border","createCubeMap","faces","target","TEXTURE_CUBE_MAP_POSITIVE_X","px","TEXTURE_CUBE_MAP_NEGATIVE_X","nx","TEXTURE_CUBE_MAP_POSITIVE_Y","py","TEXTURE_CUBE_MAP_NEGATIVE_Y","ny","TEXTURE_CUBE_MAP_POSITIVE_Z","pz","TEXTURE_CUBE_MAP_NEGATIVE_Z","nz","bufferView","createFramebuffer","colorTexture","depthTexture","depthRenderbuffer","framebufferTexture2D","COLOR_ATTACHMENT0","DEPTH_ATTACHMENT","renderbuffer","createRenderbuffer","bindRenderbuffer","RENDERBUFFER","renderbufferStorage","DEPTH_COMPONENT16","framebufferRenderbuffer","status","checkFramebufferStatus","FRAMEBUFFER_COMPLETE"],"mappings":"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"}