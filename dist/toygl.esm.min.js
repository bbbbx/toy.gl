/*
 * @license Copyright (c) 2021, Venus All Rights Reserved.
 * Available via the MIT license.
 */
function e(e){return"KEEP"===(e=e.toUpperCase())||"ZERO"===e||"REPLACE"===e||"INCR"===e||"DECR"===e||"INVERT"===e||"INCR_WRAP"===e||"DECR_WRAP"===e}function t(e,t){return null==e?t:e}t.EMPTY_OBJECT=Object.freeze({});const r=window;function E(e){return null!=e}const n={36053:"FRAMEBUFFER_COMPLETE",36054:"FRAMEBUFFER_INCOMPLETE_ATTACHMENT",36055:"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",36057:"FRAMEBUFFER_INCOMPLETE_DIMENSIONS",36061:"FRAMEBUFFER_UNSUPPORTED"};function a(e){return 0==(e&e-1)}const T={},i={},o={};function c(e){let t=0;switch(e){case 5126:t=1;break;case 35664:t=2;break;case 35665:t=3;break;case 35666:t=4;break;default:throw new Error("Unrecognize "+e+" type.")}return t}function R(e){const{name:t,size:r,type:E}=e;let n=0;switch(E){case 5126:n=1*r;break;case 35664:n=2*r;break;case 35665:n=3*r;break;case 35666:case 35674:n=4*r;break;case 35675:n=9*r;break;case 35676:n=16*r;break;default:console.warn("无法识别 attribute "+t+" 的类型："+E)}return n}function f(e,r,E){const n=e.createBuffer();return E=t(E,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,r,E),n}const _={createContext:function(e){let E,n=(e=t(e,t.EMPTY_OBJECT)).canvas;return n||(n=r.document.createElement("canvas"),n.style.width="100vw",n.style.height="100vh",n.style.setProperty("display","block"),n.width=window.innerWidth,n.height=window.innerHeight),E=e.requireWebgl2?n.getContext("webgl2",e):n.getContext("webgl",e),E},setState:function(t,r){const{depthTest:n,stencilTest:a,colorMask:T,cull:i,blend:o,viewport:c,scissor:R}=r;if(i){i.enable?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE);let e=i.face&&i.face.toUpperCase();!e||"BACK"!==e&&"FRONT"!==e&&"FRONT_AND_BACK"!==e||t.cullFace(t[e])}if(n){if(!0===n.enable?t.enable(t.DEPTH_TEST):!1===n.enable&&t.disable(t.DEPTH_TEST),n.func){const e=n.func.toUpperCase();t.depthFunc(t[e])}!0===n.write?t.depthMask(!0):!1===n.write&&t.depthMask(!1)}if(a){if(!0===a.enable?t.enable(t.STENCIL_TEST):!1===a.enable&&t.disable(t.STENCIL_TEST),E(a.writeMask)&&t.stencilMask(a.writeMask),E(a.func)&&E(a.ref)&&E(a.readMask)){if(!1===function(e){return"NEVER"===(e=e.toUpperCase())||"ALWAYS"===e||"LESS"===e||"LEQUAL"===e||"NOTEQUAL"===e||"EQUAL"===e||"GREATER"===e||"GEQUAL"===e}(a.func))throw new Error("setState: stencil func is invalid, current is "+a.func+"!");const e=a.func.toUpperCase();t.stencilFunc(t[e],a.ref,a.readMask)}if(E(a.fail)&&E(a.zfail)&&E(a.zpass)){if(!1===e(a.fail)||!1===e(a.zfail)||!1===e(a.zpass))throw new Error("setState: stencil op is invalid!");const r=a.fail.toUpperCase(),E=a.zfail.toUpperCase(),n=a.zpass.toUpperCase();t.stencilOp(t[r],t[E],t[n])}}if(T&&t.colorMask(T[0],T[1],T[2],T[3]),o){if(!0===o.enable?t.enable(t.BLEND):!1===o.enable&&t.disable(t.BLEND),o.blendColor&&t.blendColor(...o.blendColor),o.blendEquation){const e=o.blendEquation.toUpperCase(),r=t[e];if(!E(r))throw new Error(e+" is not defined.");t.blendEquation(r)}if(o.blendFunc){const e=o.blendFunc[0].toUpperCase(),r=o.blendFunc[1].toUpperCase(),n=t[e],a=t[r];if(!E(n))throw new Error("gl."+e+" is not defined.");if(!E(a))throw new Error("gl."+r+" is not defined.");t.blendFunc(n,a)}}if(c&&t.viewport(c[0],c[1],c[2],c[3]),R){!0===R.enable?t.enable(t.SCISSOR_TEST):!1===R.enable&&t.disable(t.SCISSOR_TEST);const e=R.rect;e&&t.scissor(e[0],e[1],e[2],e[3])}},clear:function(e,r){r=t(r,t.EMPTY_OBJECT);const{fb:n,color:a,depth:T,stencil:i}=r;e.bindFramebuffer(e.FRAMEBUFFER,n);let o=0;a&&(e.clearColor(a[0],a[1],a[2],a[3]),o|=e.COLOR_BUFFER_BIT),E(T)&&(e.clearDepth(T),o|=e.DEPTH_BUFFER_BIT),i&&(e.clearStencil(i),o|=e.STENCIL_BUFFER_BIT),0!==o&&e.clear(o)},draw:function(e,r){const{attributes:E,indices:n,vs:a,fs:_,count:s,fb:l}=r,A=t(r.primitiveType,e.TRIANGLES),u=t(r.uniforms,t.EMPTY_OBJECT);e.bindFramebuffer(e.FRAMEBUFFER,l);const U=a+_;let d=T[U];d||(d=function(e,t,r){const E=e.createShader(e.VERTEX_SHADER);e.shaderSource(E,t),e.compileShader(E);const n=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(n,r),e.compileShader(n);const a=e.createProgram();e.attachShader(a,E),e.attachShader(a,n),e.deleteShader(E),e.deleteShader(n),e.linkProgram(a);let T="";if(!e.getProgramParameter(a,e.LINK_STATUS))throw e.getShaderParameter(n,e.COMPILE_STATUS)||(T=e.getShaderInfoLog(n),console.error("Fragment shader failed to compiled: "+T)),e.getShaderParameter(E,e.COMPILE_STATUS)||(T=e.getShaderInfoLog(E),console.error("Vertex shader failed to compiled: "+T)),T=e.getProgramInfoLog(a),console.error("Shader program link log: "+T),new Error(info);return a}(e,a,_),T[U]=d),e.useProgram(d);const b=e.getProgramParameter(d,e.ACTIVE_ATTRIBUTES);for(let t=0;t<b;t++){const r=e.getActiveAttrib(d,t),n=r.name;if(Object.hasOwnProperty.call(E,n)){const t=E[n],a=e.getAttribLocation(d,n);if(-1===a)continue;const T=t.toString();let o=i[T];const c=R(r);if(Array.isArray(t)){const r=Float32Array;o||(o=f(e,new r(t)),i[T]=o),e.bindBuffer(e.ARRAY_BUFFER,o),e.enableVertexAttribArray(a),e.vertexAttribPointer(a,c,e.FLOAT,!1,0,0)}else((F=t)instanceof Float32Array||F instanceof Uint8Array||F instanceof Uint16Array||F instanceof Uint32Array||F instanceof Int8Array||F instanceof Int16Array||F instanceof Int32Array)&&(o||(o=f(e,t),i[T]=o),e.bindBuffer(e.ARRAY_BUFFER,o),e.enableVertexAttribArray(a),e.vertexAttribPointer(a,c,e.FLOAT,!1,0,0))}}var F;const m=e.getProgramParameter(d,e.ACTIVE_UNIFORMS),M=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);let P=0;for(let t=0;t<m;t++){const r=e.getActiveUniform(d,t);let E=r.name,n=!1;const a=E.indexOf("[");if(a>=0&&(E=E.slice(0,a),n=!0),Object.hasOwnProperty.call(u,E)){const t=u[E],a=e.getUniformLocation(d,E);if(null===a)continue;if(n){const E=c(r.type);e["uniform"+E+"fv"](a,Array.from(t));continue}const T=typeof t,i=e.TEXTURE0+P;if(t instanceof WebGLTexture){if(e.activeTexture(i),r.type===e.SAMPLER_2D)e.bindTexture(e.TEXTURE_2D,t);else{if(r.type!==e.SAMPLER_CUBE)throw new Error(r,"type MUST be SAMPLER_2D or SAMPLER_CUBE");e.bindTexture(e.TEXTURE_CUBE_MAP,t)}e.uniform1i(a,P),P++}else if(C=t,Array.isArray(C)||C&&"object"==typeof C&&"number"==typeof C.length&&(0===C.length||C.length>0&&C.length-1 in C)){const r=t.length;if(r<=4)e["uniform"+r+"fv"](a,t);else if(r<=16){const E=Math.floor(Math.sqrt(r)),n=!1;e["uniformMatrix"+E+"fv"](a,n,Array.from(t))}}else if("number"===T)e.uniform1f(a,t);else if("string"===T){if(P>M){console.error("texture exceed maximum texture units.");continue}let r=o[t];if(!r){r=e.createTexture(),e.activeTexture(i),e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array([255,255,255,255]));const E=new Image;E.src=t,E.addEventListener("load",(()=>{e.activeTexture(i),e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,E)})),o[t]=r}e.activeTexture(i),e.bindTexture(e.TEXTURE_2D,r),e.uniform1i(a,P),P++}}}var C;if(n&&n.length>0){let r,E,a=Number.MIN_SAFE_INTEGER;for(const e of n)a=Math.max(e,a);a<=255?(r=e.UNSIGNED_BYTE,E=Uint8Array):a<=65535?(r=e.UNSIGNED_SHORT,E=Uint16Array):(r=e.UNSIGNED_INT,E=Uint32Array,e.getExtension("OES_element_index_unit"));const T=n.toString();let o=i[T];o||(o=function(e,r,E){const n=e.createBuffer();return E=t(E,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n),e.bufferData(e.ELEMENT_ARRAY_BUFFER,r,E),n}(e,new E(n)),i[T]=o),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o),e.drawElements(A,s,r,0)}else e.drawArrays(A,0,s)},createTexture:function(e,t){const{level:r,internalFormat:n,type:T,format:i,width:o,height:c,data:R,wrapS:f,wrapT:_,minFilter:s,magFilter:l,generateMipmap:A}=t,u=e.createTexture();if(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,u),R instanceof HTMLImageElement||R instanceof HTMLCanvasElement||R instanceof HTMLVideoElement)e.texImage2D(e.TEXTURE_2D,r,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,R);else{const t=0;e.texImage2D(e.TEXTURE_2D,r,n,o,c,t,i,T,R)}return e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),E(f)&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,f),E(_)&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,_),E(s)&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,s),E(l)&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,l),!0===A&&(a(o)&&a(c)?e.generateMipmap(e.TEXTURE_2D):console.warn("createTexture: texture size is NOT power of two, current is "+o+"x"+c+".")),u},createCubeMap:function(e,r){r=t(r,t.EMPTY_OBJECT);const E=t(r.level,0),n=r.data,a=r.width,T=r.height,i=t(r.format,e.RGBA),o=t(r.type,e.UNSIGNED_BYTE),c=t(r.internalFormat,e.RGBA),R=e.createTexture();e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,R);const f=[{target:e.TEXTURE_CUBE_MAP_POSITIVE_X,data:n.px},{target:e.TEXTURE_CUBE_MAP_NEGATIVE_X,data:n.nx},{target:e.TEXTURE_CUBE_MAP_POSITIVE_Y,data:n.py},{target:e.TEXTURE_CUBE_MAP_NEGATIVE_Y,data:n.ny},{target:e.TEXTURE_CUBE_MAP_POSITIVE_Z,data:n.pz},{target:e.TEXTURE_CUBE_MAP_NEGATIVE_Z,data:n.nz}];for(let t=0;t<6;t++){const r=f[t],n=r.target,R=r.data;R instanceof HTMLImageElement?e.texImage2D(n,E,c,i,o,R):e.texImage2D(n,E,c,a,T,0,i,o,R),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR)}return R},createFramebuffer:function(e,r){const{colorTexture:E,depthTexture:a,depthRenderbuffer:T}=r,i=t(r.colorAttachments,[E]),o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o);const c=i.length;if(c>1){const t=e.getExtension("WebGL_draw_buffers");t.drawBuffersWEBGL([t.COLOR_ATTACHMENT0_WEBGL,t.COLOR_ATTACHMENT1_WEBGL]);for(let t=0;t<c;t++){const r=i[t];e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,r,0)}}else e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,E),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,E,0);if(a)e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0);else if(T){const t=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,t),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,T.width,T.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}const R=e.checkFramebufferStatus(e.FRAMEBUFFER);if(R!==e.FRAMEBUFFER_COMPLETE)throw new Error("createFramebuffer: framebuffer combination is NOT completed! Current status is "+n[R]+".");return o}};export default _;
//# sourceMappingURL=toygl.esm.min.js.map
