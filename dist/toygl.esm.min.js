/*
 * @license Copyright (c) 2021, Venus All Rights Reserved.
 * Available via the MIT license.
 */
function e(e){return"KEEP"===(e=e.toUpperCase())||"ZERO"===e||"REPLACE"===e||"INCR"===e||"DECR"===e||"INVERT"===e||"INCR_WRAP"===e||"DECR_WRAP"===e}function t(e,t){return null==e?t:e}t.EMPTY_OBJECT=Object.freeze({});const r=window;function E(e){return null!=e}const a={36053:"FRAMEBUFFER_COMPLETE",36054:"FRAMEBUFFER_INCOMPLETE_ATTACHMENT",36055:"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",36057:"FRAMEBUFFER_INCOMPLETE_DIMENSIONS",36061:"FRAMEBUFFER_UNSUPPORTED"};function n(e){return 0==(e&e-1)}const T={},i={},o={};function R(e){const{name:t,size:r,type:E}=e;let a=0;switch(E){case 5126:a=1*r;break;case 35664:a=2*r;break;case 35665:a=3*r;break;case 35666:case 35674:a=4*r;break;case 35675:a=9*r;break;case 35676:a=16*r;break;default:console.warn("无法识别 attribute "+t+" 的类型："+E)}return a}function _(e,r,E){const a=e.createBuffer();return E=t(E,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,r,E),a}const c={createContext:function(e){let E,a=(e=t(e,t.EMPTY_OBJECT)).canvas;return a||(a=r.document.createElement("canvas"),a.style.width="100vw",a.style.height="100vh",a.style.setProperty("display","block"),a.width=window.innerWidth,a.height=window.innerHeight),E=e.requireWebgl2?a.getContext("webgl2",e):a.getContext("webgl",e),E},setState:function(t,r){const{depthTest:a,stencilTest:n,colorMask:T,cull:i,blend:o,viewport:R,scissor:_}=r;if(i){i.enable?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE);let e=i.face&&i.face.toUpperCase();!e||"BACK"!==e&&"FRONT"!==e&&"FRONT_AND_BACK"!==e||t.cullFace(t[e])}if(a){if(!0===a.enable?t.enable(t.DEPTH_TEST):!1===a.enable&&t.disable(t.DEPTH_TEST),a.func){const e=a.func.toUpperCase();t.depthFunc(t[e])}!0===a.write?t.depthMask(!0):!1===a.write&&t.depthMask(!1)}if(n){if(!0===n.enable?t.enable(t.STENCIL_TEST):!1===n.enable&&t.disable(t.STENCIL_TEST),E(n.writeMask)&&t.stencilMask(n.writeMask),E(n.func)&&E(n.ref)&&E(n.readMask)){if(!1===function(e){return"NEVER"===(e=e.toUpperCase())||"ALWAYS"===e||"LESS"===e||"LEQUAL"===e||"NOTEQUAL"===e||"EQUAL"===e||"GREATER"===e||"GEQUAL"===e}(n.func))throw new Error("setState: stencil func is invalid, current is "+n.func+"!");const e=n.func.toUpperCase();t.stencilFunc(t[e],n.ref,n.readMask)}if(E(n.fail)&&E(n.zfail)&&E(n.zpass)){if(!1===e(n.fail)||!1===e(n.zfail)||!1===e(n.zpass))throw new Error("setState: stencil op is invalid!");const r=n.fail.toUpperCase(),E=n.zfail.toUpperCase(),a=n.zpass.toUpperCase();t.stencilOp(t[r],t[E],t[a])}}if(T&&t.colorMask(T[0],T[1],T[2],T[3]),o&&(!0===o.enable?t.enable(t.BLEND):!1===o.enable&&t.disable(t.BLEND),o.blendColor&&t.blendColor(...o.blendColor),o.blendEquation&&t.blendEquation(t[o.blendEquation.toUpperCase()]),o.blendFunc)){const e=o.blendFunc[0].toUpperCase(),r=o.blendFunc[1].toUpperCase();t.blendFunc(t[e],t[r])}if(R&&t.viewport(R[0],R[1],R[2],R[3]),_){!0===_.enable?t.enable(t.SCISSOR_TEST):!1===_.enable&&t.disable(t.SCISSOR_TEST);const e=_.rect;e&&t.scissor(e[0],e[1],e[2],e[3])}},clear:function(e,r){r=t(r,t.EMPTY_OBJECT);const{fb:a,color:n,depth:T,stencil:i}=r;e.bindFramebuffer(e.FRAMEBUFFER,a);let o=0;n&&(e.clearColor(n[0],n[1],n[2],n[3]),o|=e.COLOR_BUFFER_BIT),E(T)&&(e.clearDepth(T),o|=e.DEPTH_BUFFER_BIT),i&&(e.clearStencil(i),o|=e.STENCIL_BUFFER_BIT),0!==o&&e.clear(o)},draw:function(e,r){const{attributes:E,indices:a,vs:c,fs:s,count:f,fb:A}=r,l=t(r.primitiveType,e.TRIANGLES),U=t(r.uniforms,t.EMPTY_OBJECT);e.bindFramebuffer(e.FRAMEBUFFER,A);const u=c+s;let d=T[u];d||(d=function(e,t,r){const E=e.createShader(e.VERTEX_SHADER);e.shaderSource(E,t),e.compileShader(E);const a=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(a,r),e.compileShader(a);const n=e.createProgram();e.attachShader(n,E),e.attachShader(n,a),e.deleteShader(E),e.deleteShader(a),e.linkProgram(n);let T="";if(!e.getProgramParameter(n,e.LINK_STATUS))throw e.getShaderParameter(a,e.COMPILE_STATUS)||(T=e.getShaderInfoLog(a),console.error("Fragment shader failed to compiled: "+T)),e.getShaderParameter(E,e.COMPILE_STATUS)||(T=e.getShaderInfoLog(E),console.error("Vertex shader failed to compiled: "+T)),T=e.getProgramInfoLog(n),console.error("Shader program link log: "+T),new Error(info);return n}(e,c,s),T[u]=d),e.useProgram(d);const F=e.getProgramParameter(d,e.ACTIVE_ATTRIBUTES);for(let t=0;t<F;t++){const r=e.getActiveAttrib(d,t),a=r.name;if(Object.hasOwnProperty.call(E,a)){const t=E[a],n=e.getAttribLocation(d,a);if(-1===n)continue;const T=t.toString();let o=i[T];const c=R(r);if(Array.isArray(t)){const r=Float32Array;o||(o=_(e,new r(t)),i[T]=o),e.bindBuffer(e.ARRAY_BUFFER,o),e.enableVertexAttribArray(n),e.vertexAttribPointer(n,c,e.FLOAT,!1,0,0)}else((P=t)instanceof Float32Array||P instanceof Uint8Array||P instanceof Uint16Array||P instanceof Uint32Array||P instanceof Int8Array||P instanceof Int16Array||P instanceof Int32Array)&&(o||(o=_(e,t),i[T]=o),e.bindBuffer(e.ARRAY_BUFFER,o),e.enableVertexAttribArray(n),e.vertexAttribPointer(n,c,e.FLOAT,!1,0,0))}}var P;const b=e.getProgramParameter(d,e.ACTIVE_UNIFORMS),m=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);let M=0;for(let t=0;t<b;t++){const r=e.getActiveUniform(d,t),E=r.name;if(Object.hasOwnProperty.call(U,E)){const t=U[E],a=e.getUniformLocation(d,E);if(null===a)continue;const T=typeof t,i=e.TEXTURE0+M;if(t instanceof WebGLTexture){if(e.activeTexture(i),r.type===e.SAMPLER_2D)e.bindTexture(e.TEXTURE_2D,t);else{if(r.type!==e.SAMPLER_CUBE)throw new Error(r,"type MUST be SAMPLER_2D or SAMPLER_CUBE");e.bindTexture(e.TEXTURE_CUBE_MAP,t)}e.uniform1i(a,M),M++}else if(I=t,Array.isArray(I)||I&&"object"==typeof I&&"number"==typeof I.length&&(0===I.length||I.length>0&&I.length-1 in I)){const r=t.length;if(r<=4)e["uniform"+r+"fv"](a,t);else if(r<=16){const E=Math.floor(Math.sqrt(r)),n=!1;e["uniformMatrix"+E+"fv"](a,n,Array.from(t))}}else if("number"===T)e.uniform1f(a,t);else if("string"===T){if(M>m){console.error("texture exceed maximum texture units.");continue}let r=o[t];if(!r){r=e.createTexture(),e.activeTexture(i),e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array([255,255,255,255]));const E=new Image;E.src=t,E.addEventListener("load",(()=>{e.activeTexture(i),e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,E),n(E.width)&&n(E.height)&&(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.generateMipmap(e.TEXTURE_2D))})),o[t]=r}e.activeTexture(i),e.bindTexture(e.TEXTURE_2D,r),e.uniform1i(a,M),M++}}}var I;if(a&&a.length>0){let r,E,n=Number.MIN_SAFE_INTEGER;for(const e of a)n=Math.max(e,n);n<=255?(r=e.UNSIGNED_BYTE,E=Uint8Array):n<=65535?(r=e.UNSIGNED_SHORT,E=Uint16Array):(r=e.UNSIGNED_INT,E=Uint32Array,e.getExtension("OES_element_index_unit"));const T=a.toString();let o=i[T];o||(o=function(e,r,E){const a=e.createBuffer();return E=t(E,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a),e.bufferData(e.ELEMENT_ARRAY_BUFFER,r,E),a}(e,new E(a)),i[T]=o),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o),e.drawElements(l,f,r,0)}else e.drawArrays(l,0,f)},createTexture:function(e,t){const{level:r,internalFormat:a,type:T,format:i,width:o,height:R,data:_,wrapS:c,wrapT:s,minFilter:f,magFilter:A,generateMipmap:l}=t,U=e.createTexture();if(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,U),_ instanceof HTMLImageElement||_ instanceof HTMLCanvasElement||_ instanceof HTMLVideoElement)e.texImage2D(e.TEXTURE_2D,r,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,_);else{const t=0;e.texImage2D(e.TEXTURE_2D,r,a,o,R,t,i,T,_)}return e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),E(c)&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,c),E(s)&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,s),E(f)&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,f),E(A)&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,A),!0===l&&(n(o)&&n(R)?e.generateMipmap(e.TEXTURE_2D):console.warn("createTexture: texture size is NOT power of two, current is "+o+"x"+R+".")),U},createCubeMap:function(e,r){r=t(r,t.EMPTY_OBJECT);const E=t(r.level,0),a=r.data,n=r.width,T=r.height,i=t(r.format,e.RGBA),o=t(r.type,e.UNSIGNED_BYTE),R=t(r.internalFormat,e.RGBA),_=e.createTexture();e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,_);const c=[{target:e.TEXTURE_CUBE_MAP_POSITIVE_X,data:a.px},{target:e.TEXTURE_CUBE_MAP_NEGATIVE_X,data:a.nx},{target:e.TEXTURE_CUBE_MAP_POSITIVE_Y,data:a.py},{target:e.TEXTURE_CUBE_MAP_NEGATIVE_Y,data:a.ny},{target:e.TEXTURE_CUBE_MAP_POSITIVE_Z,data:a.pz},{target:e.TEXTURE_CUBE_MAP_NEGATIVE_Z,data:a.nz}];for(let t=0;t<6;t++){const r=c[t],a=r.target,_=r.data;_ instanceof HTMLImageElement?e.texImage2D(a,E,R,i,o,_):e.texImage2D(a,E,R,n,T,0,i,o,_),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR)}return _},createFramebuffer:function(e,t){const{colorTexture:r,depthTexture:E,depthRenderbuffer:n}=t,T=e.createFramebuffer();if(e.bindFramebuffer(e.FRAMEBUFFER,T),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0),E)e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,E),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,E,0);else if(n){const t=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,t),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}const i=e.checkFramebufferStatus(e.FRAMEBUFFER);if(i!==e.FRAMEBUFFER_COMPLETE)throw new Error("createFramebuffer: framebuffer combination is NOT completed! Current status is "+a[i]+".");return T}};export default c;
//# sourceMappingURL=toygl.esm.min.js.map
