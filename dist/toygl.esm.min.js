/*
 * @license Copyright (c) 2021, Venus All Rights Reserved.
 * Available via the MIT license.
 */
function e(e){return null!=e}function E(e){return"KEEP"===(e=e.toUpperCase())||"ZERO"===e||"REPLACE"===e||"INCR"===e||"DECR"===e||"INVERT"===e||"INCR_WRAP"===e||"DECR_WRAP"===e}function t(E,t){const r=E[t];if(!e(r))throw new Error("gl."+t+" is not defined.");return r}function r(e,E){return null==e?E:e}r.EMPTY_OBJECT=Object.freeze({});const a=window;function T(t,r,a){if(e(a.writeMask)&&t.stencilMaskSeparate(r,a.writeMask),e(a.func)&&e(a.ref)&&e(a.valueMask)){if(!1===function(e){return"NEVER"===(e=e.toUpperCase())||"ALWAYS"===e||"LESS"===e||"LEQUAL"===e||"NOTEQUAL"===e||"EQUAL"===e||"GREATER"===e||"GEQUAL"===e}(a.func))throw new Error("setState: stencil func is invalid, current is "+a.func+"!");const e=a.func.toUpperCase();t.stencilFuncSeparate(r,t[e],a.ref,a.valueMask)}if(e(a.fail)&&e(a.zfail)&&e(a.zpass)){if(!1===E(a.fail)||!1===E(a.zfail)||!1===E(a.zpass))throw new Error("setState: stencil op is invalid, current is "+a.fail+", "+a.zfail+", "+a.zpass+"!");const e=a.fail.toUpperCase(),T=a.zfail.toUpperCase(),_=a.zpass.toUpperCase();t.stencilOpSeparate(r,t[e],t[T],t[_])}}const _={34016:"ACTIVE_TEXTURE",33984:"TEXTURE0",33985:"TEXTURE1",33986:"TEXTURE2",33987:"TEXTURE3",33988:"TEXTURE4",33989:"TEXTURE5",33990:"TEXTURE6",33991:"TEXTURE7",33992:"TEXTURE8",33993:"TEXTURE9",33994:"TEXTURE10",33995:"TEXTURE11",33996:"TEXTURE12",33997:"TEXTURE13",33998:"TEXTURE14",33999:"TEXTURE15",34e3:"TEXTURE16",34001:"TEXTURE17",34002:"TEXTURE18",34003:"TEXTURE19",34004:"TEXTURE20",34005:"TEXTURE21",34006:"TEXTURE22",34007:"TEXTURE23",34008:"TEXTURE24",34009:"TEXTURE25",34010:"TEXTURE26",34011:"TEXTURE27",34012:"TEXTURE28",34013:"TEXTURE29",34014:"TEXTURE30",34015:"TEXTURE31",3410:"RED_BITS",3411:"GREEN_BITS",3412:"BLUE_BITS",3413:"ALPHA_BITS",2884:"CULL_FACE",2885:"CULL_FACE_MODE",1028:"FRONT",1029:"BACK",1032:"FRONT_AND_BACK",512:"NEVER",513:"LESS",514:"EQUAL",515:"LEQUAL",516:"GREATER",517:"NOTEQUAL",518:"GEQUAL",519:"ALWAYS",0:"ZERO",1:"ONE",5386:"INVERT",7680:"KEEP",7681:"REPLACE",7682:"INCR",7683:"DECR",34055:"INCR_WRAP",34056:"DECR_WRAP",32774:"FUNC_ADD",32778:"FUNC_SUBTRACT",32779:"FUNC_REVERSE_SUBTRACT",768:"SRC_COLOR",770:"SRC_ALPHA",774:"DST_COLOR",772:"DST_ALPHA",32769:"CONSTANT_COLOR",32771:"CONSTANT_ALPHA",769:"ONE_MINUS_SRC_COLOR",771:"ONE_MINUS_SRC_ALPHA",775:"ONE_MINUS_DST_COLOR",773:"ONE_MINUS_DST_ALPHA",32770:"ONE_MINUS_CONSTANT_COLOR",32772:"ONE_MINUS_CONSTANT_ALPHA",2304:"CW",2305:"CCW",4352:"DONT_CARE",4353:"FASTEST",4354:"NICEST",33776:"COMPRESSED_RGB_S3TC_DXT1_EXT",33777:"COMPRESSED_RGBA_S3TC_DXT1_EXT",33778:"COMPRESSED_RGBA_S3TC_DXT3_EXT",33779:"COMPRESSED_RGBA_S3TC_DXT5_EXT",36492:"COMPRESSED_RGBA_BPTC_UNORM_EXT",36493:"COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",36494:"COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",36495:"COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",36283:"COMPRESSED_RED_RGTC1_EXT",36284:"COMPRESSED_SIGNED_RED_RGTC1_EXT",36285:"COMPRESSED_RED_GREEN_RGTC2_EXT",36286:"COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",37444:"BROWSER_DEFAULT_WEBGL",BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126};const n={36053:"FRAMEBUFFER_COMPLETE",36054:"FRAMEBUFFER_INCOMPLETE_ATTACHMENT",36055:"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",36057:"FRAMEBUFFER_INCOMPLETE_DIMENSIONS",36061:"FRAMEBUFFER_UNSUPPORTED"};function R(e){return 0==(e&e-1)}const A={};function o(e){let E;if(Array.isArray(e))E=_.UNSIGNED_SHORT;else if(e instanceof Uint8Array)E=_.UNSIGNED_BYTE;else if(e instanceof Uint16Array)E=_.UNSIGNED_SHORT;else{if(!(e instanceof Uint32Array))throw new Error("indices MUST be instance of Array, Uint8Array, Uint16Array or Uint32Array.");E=_.UNSIGNED_INT}return E}function i(e,E,t,r){const a=e.createBuffer();return e.bindBuffer(E,a),e.bufferData(E,t,r),e.bindBuffer(E,null),a}function S(e,E,t){const a=E.toString();let T,_=A[a];if(_)return _;if(t=r(t,e.STATIC_DRAW),Array.isArray(E))T=new Float32Array(E);else{if(!((n=E)instanceof Float32Array||n instanceof Uint8Array||n instanceof Uint16Array||n instanceof Uint32Array||n instanceof Int8Array||n instanceof Int16Array||n instanceof Int32Array))throw new Error("Buffer data"+E+"must be TypedArray or Array ");T=E}var n;return _=i(e,e.ARRAY_BUFFER,T,t),A[a]=_,_}function s(e,E,t){const a=E.toString();let T,_=A[a];if(_)return _;t=r(t,e.STATIC_DRAW);const n=o(E);if(n===e.UNSIGNED_BYTE)T=new Uint8Array(E);else if(n===e.UNSIGNED_SHORT)T=new Uint16Array(E);else{if(n!==e.UNSIGNED_INT)throw new Error("Buffer data must be TypedArray or Array ");T=new Uint32Array(E),e.getExtension("OES_element_index_unit")}return _=i(e,e.ELEMENT_ARRAY_BUFFER,T,t),A[a]=_,_}const N={},U={};function P(e){let E=0;switch(e){case 5126:E=1;break;case 35664:E=2;break;case 35665:E=3;break;case 35666:E=4;break;default:throw new Error("Unrecognize "+e+" type.")}return E}function I(e){const{name:E,size:t,type:r}=e;let a=0;switch(r){case 5126:a=1*t;break;case 35664:a=2*t;break;case 35665:a=3*t;break;case 35666:case 35674:a=4*t;break;case 35675:a=9*t;break;case 35676:a=16*t;break;default:console.warn(`Can not recognize attribute ${E} type, current type is ${r}`)}return a}const C={createContext:function(e){let E,t=(e=r(e,r.EMPTY_OBJECT)).canvas;return t||(t=a.document.createElement("canvas"),t.style.width="100vw",t.style.height="100vh",t.style.setProperty("display","block"),t.width=window.innerWidth,t.height=window.innerHeight),E=e.requireWebgl2?t.getContext("webgl2",e):t.getContext("webgl",e),E},setState:function(E,r){const{depthTest:a,stencilTest:_,colorMask:n,cull:R,blend:A,viewport:o,scissor:i,polygonOffset:S,sampleCoverage:s,dither:N}=r;if(R){R.enable?E.enable(E.CULL_FACE):E.disable(E.CULL_FACE);const t=R.face&&R.face.toUpperCase();"BACK"!==t&&"FRONT"!==t&&"FRONT_AND_BACK"!==t||E.cullFace(E[t]);let r=e(R.frontFace)&&R.frontFace.toUpperCase();"CCW"!==r&&"CW"!==r||E.frontFace(E[r])}if(a){if(!0===a.enable?E.enable(E.DEPTH_TEST):!1===a.enable&&E.disable(E.DEPTH_TEST),a.func){const e=a.func.toUpperCase();E.depthFunc(E[e])}!0===a.write?E.depthMask(!0):!1===a.write&&E.depthMask(!1)}if(_){!0===_.enable?E.enable(E.STENCIL_TEST):!1===_.enable&&E.disable(E.STENCIL_TEST);const{front:e,back:t}=_;e&&T(E,E.FRONT,e),t&&T(E,E.BACK,t)}if(n&&E.colorMask(n[0],n[1],n[2],n[3]),A){if(!0===A.enable?E.enable(E.BLEND):!1===A.enable&&E.disable(E.BLEND),A.blendColor&&E.blendColor(...A.blendColor),A.blendEquationSeparate){const{rgb:t,alpha:r}=A.blendEquationSeparate;if(!e(t)||!e(r))throw new Error("To use blendEquationSeparate you MUST specify rgb and alpha.");const a=t.toUpperCase(),T=r.toUpperCase(),_=E[a],n=E[T];if(!e(_))throw new Error("gl."+a+" is undefined.");if(!e(n))throw new Error("gl."+T+" is undefined.");E.blendEquationSeparate(_,n)}else if(A.blendEquation){const t=A.blendEquation.toUpperCase(),r=E[t];if(!e(r))throw new Error(t+" is invalid.");E.blendEquation(r)}const r=A.blendFuncSeparate;if(e(r)){const{srcRGB:a,dstRGB:T,srcAlpha:_,dstAlpha:n}=r;if(!e(a))throw new Error("To use blendFuncSeparate you MUST specify srcRGB property.");if(!e(T))throw new Error("To use blendFuncSeparate you MUST specify dstRGB property.");if(!e(_))throw new Error("To use blendFuncSeparate you MUST specify srcAlpha property.");if(!e(n))throw new Error("To use blendFuncSeparate you MUST specify dstAlpha property.");const R=a.toUpperCase(),A=T.toUpperCase(),o=_.toUpperCase(),i=n.toUpperCase(),S=t(E,R),s=t(E,A),N=t(E,o),U=t(E,i);E.blendFuncSeparate(S,s,N,U)}else if(e(A.blendFunc)){const e=A.blendFunc[0].toUpperCase(),r=A.blendFunc[1].toUpperCase(),a=t(E,e),T=t(E,r);E.blendFunc(a,T)}}if(o&&E.viewport(o[0],o[1],o[2],o[3]),i){!0===i.enable?E.enable(E.SCISSOR_TEST):!1===i.enable&&E.disable(E.SCISSOR_TEST);const e=i.rect;e&&E.scissor(e[0],e[1],e[2],e[3])}if(e(S)&&(!0===S.enable?E.enable(E.POLYGON_OFFSET_FILL):!1===S.enable?E.disable(E.POLYGON_OFFSET_FILL):console.warn("polygonOffset.enable MUST be either true or false, current is "+S.enable.toString()+"."),E.polygonOffset(S.factor,S.units)),e(s)){const{alphaToCoverage:t,value:r,invert:a,enable:T}=s;!0===t?E.enable(E.SAMPLE_ALPHA_TO_COVERAGE):!1===t&&E.disable(E.SAMPLE_ALPHA_TO_COVERAGE),!0===T?E.enable(E.SAMPLE_COVERAGE):!1===T&&E.disable(E.SAMPLE_COVERAGE),e(r)&&e(a)&&(!0!==a&&!1!==a&&console.warn("sampleCoverage.invert MUST be boolean."),E.sampleCoverage(r,a))}e(N)&&(!0===N?E.enable(E.DITHER):!1===N?E.disable(E.DITHER):console.warn("setState: dither MUST be a boolean value, otherwise it will be ignored."))},getState:function(e){const E=e.getParameter(e.CULL_FACE),t=e.getParameter(e.CULL_FACE_MODE),r=e.getParameter(e.DEPTH_TEST),a=e.getParameter(e.DEPTH_CLEAR_VALUE),T=e.getParameter(e.DEPTH_FUNC),n=e.getParameter(e.DEPTH_WRITEMASK),R=e.getParameter(e.DEPTH_RANGE),A=e.getParameter(e.DEPTH_BITS),o=e.getParameter(e.STENCIL_TEST),i=e.getParameter(e.STENCIL_CLEAR_VALUE),S=e.getParameter(e.STENCIL_REF),s=e.getParameter(e.STENCIL_FUNC),N=e.getParameter(e.STENCIL_FAIL),U=e.getParameter(e.STENCIL_PASS_DEPTH_FAIL),P=e.getParameter(e.STENCIL_PASS_DEPTH_PASS),I=e.getParameter(e.STENCIL_VALUE_MASK),C=e.getParameter(e.STENCIL_WRITEMASK),c=e.getParameter(e.STENCIL_BACK_REF),L=e.getParameter(e.STENCIL_BACK_FUNC),l=e.getParameter(e.STENCIL_BACK_FAIL),f=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_FAIL),u=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_PASS),O=e.getParameter(e.STENCIL_BACK_VALUE_MASK),D=e.getParameter(e.STENCIL_BACK_WRITEMASK),B=e.getParameter(e.STENCIL_BITS),M=e.getParameter(e.BLEND),F=e.getParameter(e.BLEND_COLOR),m=e.getParameter(e.BLEND_DST_RGB),g=e.getParameter(e.BLEND_DST_ALPHA),d=e.getParameter(e.BLEND_SRC_RGB),b=e.getParameter(e.BLEND_SRC_ALPHA),X=e.getParameter(e.BLEND_EQUATION_RGB),G=e.getParameter(e.BLEND_EQUATION_ALPHA),p=e.getParameter(e.VIEWPORT),x=e.getParameter(e.MAX_VIEWPORT_DIMS),h=e.getParameter(e.SCISSOR_TEST),w=e.getParameter(e.SCISSOR_BOX),y=e.getParameter(e.POLYGON_OFFSET_FILL),H=e.getParameter(e.POLYGON_OFFSET_FACTOR),V=e.getParameter(e.POLYGON_OFFSET_UNITS),W=e.getParameter(e.DITHER),v=e.getParameter(e.RED_BITS),Y=e.getParameter(e.GREEN_BITS),K=e.getParameter(e.BLUE_BITS),k=e.getParameter(e.ALPHA_BITS),z=e.getParameter(e.SUBPIXEL_BITS),Q=e.getParameter(e.ALIASED_LINE_WIDTH_RANGE),Z=e.getParameter(e.ALIASED_POINT_SIZE_RANGE),j=e.getParameter(e.COLOR_WRITEMASK),q=e.getParameter(e.COLOR_CLEAR_VALUE),J=e.getParameter(e.ACTIVE_TEXTURE),$=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),ee=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),Ee=e.getParameter(e.MAX_TEXTURE_SIZE),te=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),re=e.getParameter(e.MAX_RENDERBUFFER_SIZE),ae=e.getParameter(e.MAX_VERTEX_ATTRIBS),Te=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),_e=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),ne=e.getParameter(e.MAX_VARYING_VECTORS),Re=e.getParameter(e.PACK_ALIGNMENT),Ae=e.getParameter(e.UNPACK_ALIGNMENT),oe=e.getParameter(e.UNPACK_COLORSPACE_CONVERSION_WEBGL),ie=e.getParameter(e.UNPACK_FLIP_Y_WEBGL),Se=e.getParameter(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL),se=e.getParameter(e.VENDOR),Ne=e.getParameter(e.VERSION),Ue=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),Pe=e.getParameter(e.CURRENT_PROGRAM),Ie=e.getParameter(e.ARRAY_BUFFER_BINDING),Ce=e.getParameter(e.ELEMENT_ARRAY_BUFFER_BINDING),ce=e.getParameter(e.FRAMEBUFFER_BINDING),Le=e.getParameter(e.RENDERBUFFER_BINDING),le=e.getParameter(e.TEXTURE_BINDING_2D),fe=e.getParameter(e.TEXTURE_BINDING_CUBE_MAP),ue=e.getParameter(e.RENDERER),Oe=e.getParameter(e.SAMPLES),De=e.getParameter(e.SAMPLE_BUFFERS),Be=e.getParameter(e.SAMPLE_ALPHA_TO_COVERAGE),Me=e.getParameter(e.SAMPLE_COVERAGE_INVERT),Fe=e.getParameter(e.SAMPLE_COVERAGE_VALUE),me=e.getParameter(e.FRONT_FACE),ge=e.getParameter(e.LINE_WIDTH),de=e.getParameter(e.GENERATE_MIPMAP_HINT),be=e.getParameter(e.SHADING_LANGUAGE_VERSION);return{cullFace:{CULL_FACE:E,CULL_FACE_MODE:_[t]},depth:{DEPTH_TEST:r,DEPTH_CLEAR_VALUE:a,DEPTH_FUNC:_[T],DEPTH_WRITEMASK:n,DEPTH_RANGE:R,DEPTH_BITS:A},stencil:{STENCIL_TEST:o,STENCIL_CLEAR_VALUE:i,STENCIL_BITS:B,front:{STENCIL_REF:S,STENCIL_FUNC:_[s],STENCIL_FAIL:_[N],STENCIL_PASS_DEPTH_FAIL:_[U],STENCIL_PASS_DEPTH_PASS:_[P],STENCIL_VALUE_MASK:Number(I).toString(16),STENCIL_WRITEMASK:Number(C).toString(16)},back:{STENCIL_BACK_REF:c,STENCIL_BACK_FUNC:_[L],STENCIL_BACK_FAIL:_[l],STENCIL_BACK_PASS_DEPTH_FAIL:_[f],STENCIL_BACK_PASS_DEPTH_PASS:_[u],STENCIL_BACK_VALUE_MASK:Number(O).toString(16),STENCIL_BACK_WRITEMASK:Number(D).toString(16)}},blend:{BLEND:M,BLEND_COLOR:F,BLEND_DST_RGB:_[m],BLEND_DST_ALPHA:_[g],BLEND_SRC_RGB:_[d],BLEND_SRC_ALPHA:_[b],BLEND_EQUATION_RGB:_[X],BLEND_EQUATION_ALPHA:_[G]},viewport:{VIEWPORT:p,MAX_VIEWPORT_DIMS:x},scissor:{SCISSOR_TEST:h,SCISSOR_BOX:w},polygonOffset:{POLYGON_OFFSET_FILL:y,POLYGON_OFFSET_FACTOR:H,POLYGON_OFFSET_UNITS:V},DITHER:W,binding:{ARRAY_BUFFER_BINDING:Ie,ELEMENT_ARRAY_BUFFER_BINDING:Ce,CURRENT_PROGRAM:Pe,FRAMEBUFFER_BINDING:ce,RENDERBUFFER_BINDING:Le,TEXTURE_BINDING_2D:le,TEXTURE_BINDING_CUBE:fe},RENDERER:ue,color:{RED_BITS:v,GREEN_BITS:Y,BLUE_BITS:K,ALPHA_BITS:k,SUBPIXEL_BITS:z,COLOR_CLEAR_VALUE:q,COLOR_WRITEMASK:j},aliasedRange:{ALIASED_LINE_WIDTH_RANGE:Q,ALIASED_POINT_SIZE_RANGE:Z},texture:{MAX_TEXTURE_IMAGE_UNITS:$,MAX_COMBINED_TEXTURE_IMAGE_UNITS:ee,ACTIVE_TEXTURE:_[J],MAX_TEXTURE_SIZE:Ee,MAX_CUBE_MAP_TEXTURE_SIZE:te,MAX_RENDERBUFFER_SIZE:re},COMPRESSED_TEXTURE_FORMATS:Array.from(Ue).map((e=>_[e])),GENERATE_MIPMAP_HINT:_[de],LINE_WIDTH:ge,FRONT_FACE:_[me],SHADING_LANGUAGE_VERSION:be,vertex:{MAX_VERTEX_ATTRIBS:ae,MAX_VERTEX_TEXTURE_IMAGE_UNITS:Te,MAX_VERTEX_UNIFORM_VECTORS:_e,MAX_VARYING_VECTORS:ne},sample:{SAMPLES:Oe,SAMPLE_BUFFERS:De,SAMPLE_ALPHA_TO_COVERAGE:Be,SAMPLE_COVERAGE_VALUE:Fe,SAMPLE_COVERAGE_INVERT:Me},unpack:{PACK_ALIGNMENT:Re,UNPACK_ALIGNMENT:Ae,UNPACK_FLIP_Y_WEBGL:ie,UNPACK_PREMULTIPLY_ALPHA_WEBGL:Se,UNPACK_COLORSPACE_CONVERSION_WEBGL:_[oe]},VENDOR:se,VERSION:Ne}},clear:function(E,t){t=r(t,r.EMPTY_OBJECT);const{fb:a,color:T,depth:_,stencil:n}=t;E.bindFramebuffer(E.FRAMEBUFFER,a);let R=0;T&&(E.clearColor(T[0],T[1],T[2],T[3]),R|=E.COLOR_BUFFER_BIT),e(_)&&(E.clearDepth(_),R|=E.DEPTH_BUFFER_BIT),n&&(E.clearStencil(n),R|=E.STENCIL_BUFFER_BIT),0!==R&&E.clear(R)},draw:function(E,t){const{attributes:a,indices:T,vao:_,vs:n,fs:R,attributeLocations:A,fb:i}=t;let C=t.count;if(!e(C)&&e(T)&&(C=T.length),!e(C))throw new Error("vertices count or indices is not defined.");if(e(_)&&!e(A))throw new Error("To use vao, you must defined attributeLocations.");const c=r(t.primitiveType,E.TRIANGLES),L=r(t.uniforms,r.EMPTY_OBJECT);E.bindFramebuffer(E.FRAMEBUFFER,i);const l=n+R;let f=N[l];f||(f=function(E,t,r,a){const T=E.createShader(E.VERTEX_SHADER);E.shaderSource(T,t),E.compileShader(T);const _=E.createShader(E.FRAGMENT_SHADER);E.shaderSource(_,r),E.compileShader(_);const n=E.createProgram();if(E.attachShader(n,T),E.attachShader(n,_),E.deleteShader(T),E.deleteShader(_),e(a))for(const e in a)if(Object.hasOwnProperty.call(a,e)){const t=a[e];E.bindAttribLocation(n,t,e)}E.linkProgram(n);let R="";return E.getProgramParameter(n,E.LINK_STATUS)||(E.getShaderParameter(_,E.COMPILE_STATUS)||(R=E.getShaderInfoLog(_),console.error("Fragment shader failed to compiled: "+R)),E.getShaderParameter(T,E.COMPILE_STATUS)||(R=E.getShaderInfoLog(T),console.error("Vertex shader failed to compiled: "+R)),R=E.getProgramInfoLog(n),console.error("Shader program link log: "+R)),n}(E,n,R,A),N[l]=f),E.useProgram(f);const u=E.getProgramParameter(f,E.ACTIVE_ATTRIBUTES),O=E.getExtension("OES_vertex_array_object");if(e(_))if(O)O.bindVertexArrayOES(_);else{if(!(E instanceof WebGL2RenderingContext))throw new Error("this branch never should be executed.");E.bindVertexArray(_)}else{if(!e(a))throw new Error("vao or attributes must be defined.");O&&O.bindVertexArrayOES(null);for(let e=0;e<u;e++){const t=E.getActiveAttrib(f,e),r=t.name;if(Object.hasOwnProperty.call(a,r)){const e=a[r],T=E.getAttribLocation(f,r);if(-1===T)continue;const _=I(t),n=S(E,e,E.STATIC_DRAW);E.bindBuffer(E.ARRAY_BUFFER,n),E.enableVertexAttribArray(T),E.vertexAttribPointer(T,_,E.FLOAT,!1,0,0)}}}const D=E.getProgramParameter(f,E.ACTIVE_UNIFORMS),B=E.getParameter(E.MAX_TEXTURE_IMAGE_UNITS);let M=0;for(let e=0;e<D;e++){const t=E.getActiveUniform(f,e);let r=t.name,a=!1;const T=r.indexOf("[");if(T>=0&&(r=r.slice(0,T),a=!0),Object.hasOwnProperty.call(L,r)){const e=L[r],T=E.getUniformLocation(f,r);if(null===T)continue;if(a){const r=P(t.type);E["uniform"+r+"fv"](T,Array.from(e));continue}const _=typeof e,n=E.TEXTURE0+M;if(e instanceof WebGLTexture){if(E.activeTexture(n),t.type===E.SAMPLER_2D)E.bindTexture(E.TEXTURE_2D,e);else{if(t.type!==E.SAMPLER_CUBE)throw new Error(t,"type MUST be SAMPLER_2D or SAMPLER_CUBE");E.bindTexture(E.TEXTURE_CUBE_MAP,e)}E.uniform1i(T,M),M++}else if(F=e,Array.isArray(F)||F&&"object"==typeof F&&"number"==typeof F.length&&(0===F.length||F.length>0&&F.length-1 in F)){const t=e.length;if(t<=4)E["uniform"+t+"fv"](T,e);else if(t<=16){const r=Math.floor(Math.sqrt(t)),a=!1;E["uniformMatrix"+r+"fv"](T,a,Array.from(e))}}else if("number"===_)E.uniform1f(T,e);else if("string"===_){if(M>B){console.error("texture exceed maximum texture units.");continue}let t=U[e];if(!t){t=E.createTexture(),E.activeTexture(n),E.bindTexture(E.TEXTURE_2D,t),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,E.LINEAR),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,E.LINEAR),E.texImage2D(E.TEXTURE_2D,0,E.RGBA,1,1,0,E.RGBA,E.UNSIGNED_BYTE,new Uint8Array([255,255,255,255]));const r=new Image;r.src=e,r.addEventListener("load",(()=>{E.activeTexture(n),E.bindTexture(E.TEXTURE_2D,t),E.texImage2D(E.TEXTURE_2D,0,E.RGBA,E.RGBA,E.UNSIGNED_BYTE,r)})),U[e]=t}E.activeTexture(n),E.bindTexture(E.TEXTURE_2D,t),E.uniform1i(T,M),M++}}}var F;const m=E.getParameter(E.ELEMENT_ARRAY_BUFFER_BINDING);if(T&&T.length>0){const e=s(E,T,E.STATIC_DRAW);E.bindBuffer(E.ELEMENT_ARRAY_BUFFER,e);const t=o(T);E.drawElements(c,C,t,0)}else O&&E.getParameter(O.VERTEX_ARRAY_BINDING_OES)&&m?E.drawElements(c,C,E.UNSIGNED_SHORT,0):E.drawArrays(c,0,C)},createTexture:function(e,E){const{internalFormat:t,type:a,format:T,width:_,height:n,data:A,generateMipmap:o}=E,i=r(E.wrapS,e.CLAMP_TO_EDGE),S=r(E.wrapT,e.CLAMP_TO_EDGE),s=r(E.minFilter,e.LINEAR),N=r(E.magFilter,e.LINEAR);let U=E.levels;U||(U=[A]);const P=r(E.flipY,!1),I=r(E.premultiplyAlpha,!1);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,P),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,I);const C=e.createTexture();e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,C),(t===e.DEPTH_COMPONENT||e.DEPTH_STENCIL)&&e.getExtension("WEBGL_depth_texture"),a===e.FLOAT&&(e.getExtension("OES_texture_float"),s!==e.LINEAR&&s!==e.LINEAR_MIPMAP_NEAREST&&s!==e.NEAREST_MIPMAP_LINEAR&&s!==e.LINEAR_MIPMAP_LINEAR||e.getExtension("OES_texture_float_linear"));const c=U.length;for(let E=0;E<c;E++){const r=U[E];if(r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement)e.texImage2D(e.TEXTURE_2D,E,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r);else{const R=0;e.texImage2D(e.TEXTURE_2D,E,t,_,n,R,T,a,r)}}return e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,S),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,N),!0===o&&(R(_)&&R(n)?e.generateMipmap(e.TEXTURE_2D):console.warn("createTexture: texture size is NOT power of two, current is "+_+"x"+n+".")),e.bindTexture(e.TEXTURE_2D,null),C},updateTexture:function(e,E,t){if(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,E),t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement)e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,videoElem);else{const{width:E,height:a,arrayBufferView:T}=t,_=r(t.level,0),n=r(t.internalFormat,e.RGBA),R=r(t.format,e.RGBA),A=r(t.internalFormat,e.UNSIGNED_BYTE),o=0;e.texImage2D(e.TEXTURE_2D,_,n,E,a,o,R,A,T)}return e.bindTexture(e.TEXTURE_2D,null),E},createCubeMap:function(e,E){E=r(E,r.EMPTY_OBJECT);const t=r(E.level,0),a=E.data,T=E.width,_=E.height,n=r(E.format,e.RGBA),R=r(E.type,e.UNSIGNED_BYTE),A=r(E.internalFormat,e.RGBA),o=e.createTexture();e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,o);const i=[{target:e.TEXTURE_CUBE_MAP_POSITIVE_X,data:a.px},{target:e.TEXTURE_CUBE_MAP_NEGATIVE_X,data:a.nx},{target:e.TEXTURE_CUBE_MAP_POSITIVE_Y,data:a.py},{target:e.TEXTURE_CUBE_MAP_NEGATIVE_Y,data:a.ny},{target:e.TEXTURE_CUBE_MAP_POSITIVE_Z,data:a.pz},{target:e.TEXTURE_CUBE_MAP_NEGATIVE_Z,data:a.nz}];for(let E=0;E<6;E++){const r=i[E],a=r.target,o=r.data;o instanceof HTMLImageElement?e.texImage2D(a,t,A,n,R,o):e.texImage2D(a,t,A,T,_,0,n,R,o),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR)}return e.bindTexture(e.TEXTURE_CUBE_MAP,null),o},createVAO:function(E,t){let r,a;if(E instanceof WebGLRenderingContext){if(r=E.getExtension("OES_vertex_array_object"),!r)throw new Error("Your device does not support VAO(OES_vertex_array_object extension), try to use vertex attributes.");a=r.createVertexArrayOES(),r.bindVertexArrayOES(a)}else{if(!(E instanceof WebGL2RenderingContext))throw new Error("gl MUST be instance of WebGLRenderingContext or WebGL2RenderingContext.");a=E.createVertexArray(),E.bindVertexArray(a)}const T=t.attributes,_=t.indices;for(const e in T)if(Object.hasOwnProperty.call(T,e)){const{location:t,data:r,size:a}=T[e],_=S(E,r,E.STATIC_DRAW);E.bindBuffer(E.ARRAY_BUFFER,_),E.enableVertexAttribArray(t);const n=E.FLOAT,R=!1,A=0,o=0;E.vertexAttribPointer(t,a,n,R,A,o)}if(e(_)){const e=s(E,_,E.STATIC_DRAW);E.bindBuffer(E.ELEMENT_ARRAY_BUFFER,e)}return E instanceof WebGLRenderingContext?r.bindVertexArrayOES(null):E instanceof WebGL2RenderingContext&&E.bindVertexArray(null),a},createFramebuffer:function(e,E){const{colorTexture:t,depthTexture:a,depthRenderbuffer:T}=E,_=r(E.colorAttachments,[t]),R=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,R),e.activeTexture(e.TEXTURE0);const A=_.length;if(A>1){const E=e.getExtension("WebGL_draw_buffers"),t=[];for(let e=0;e<A;e++)t.push(E.COLOR_ATTACHMENT0_WEBGL+e);E.drawBuffersWEBGL(t);for(let E=0;E<A;E++){const t=_[E];e.bindTexture(e.TEXTURE_2D,t),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+E,e.TEXTURE_2D,t,0)}}else e.bindTexture(e.TEXTURE_2D,t),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0);if(e.bindTexture(e.TEXTURE_2D,null),a)e.bindTexture(e.TEXTURE_2D,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0),e.bindTexture(e.TEXTURE_2D,null);else if(T){const E=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,E),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,T.width,T.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,E),e.bindRenderbuffer(e.RENDERBUFFER,null)}const o=e.checkFramebufferStatus(e.FRAMEBUFFER);if(o!==e.FRAMEBUFFER_COMPLETE)throw new Error("createFramebuffer: framebuffer combination is NOT completed! Current status is "+n[o]+".");return R}};export default C;
//# sourceMappingURL=toygl.esm.min.js.map
