/*
 * @license Copyright (c) 2021, Venus All Rights Reserved.
 * Available via the MIT license.
 */
var ToyGL=function(){"use strict";const e=window;function t(t){const r=e.devicePixelRatio,n=e.innerWidth,E=e.innerHeight;t.width=n*r,t.height=E*r,t.style.setProperty("width",n+"px"),t.style.setProperty("height",E+"px")}function r(e){return"KEEP"===(e=e.toUpperCase())||"ZERO"===e||"REPLACE"===e||"INCR"===e||"DECR"===e||"INVERT"===e||"INCR_WRAP"===e||"DECR_WRAP"===e}function n(e,t){return null==e?t:e}n.EMPTY_OBJECT=Object.freeze({});const E=window;function a(e){return null!=e}const T={36053:"FRAMEBUFFER_COMPLETE",36054:"FRAMEBUFFER_INCOMPLETE_ATTACHMENT",36055:"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",36057:"FRAMEBUFFER_INCOMPLETE_DIMENSIONS",36061:"FRAMEBUFFER_UNSUPPORTED"};function i(e){return 0==(e&e-1)}const o={},R={},c={};function f(e,t,r){const E=e.createBuffer();return r=n(r,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,E),e.bufferData(e.ARRAY_BUFFER,t,r),E}return{createContext:function(e){e=n(e,n.EMPTY_OBJECT);const r=E.document.createElement("canvas");let a;return a=e.requireWebgl2?r.getContext("webgl2",e):r.getContext("webgl",e),r.style.setProperty("display","block"),t(a.canvas),a},setState:function(e,t){const{depthTest:n,stencilTest:E,colorMask:T,cull:i,blend:o,viewport:R,scissor:c}=t;if(i){i.enable?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE);let t=i.face&&i.face.toUpperCase();!t||"BACK"!==t&&"FRONT"!==t&&"FRONT_AND_BACK"!==t||e.cullFace(e[t])}if(n){if(!0===n.enable?e.enable(e.DEPTH_TEST):!1===n.enable&&e.disable(e.DEPTH_TEST),n.func){const t=n.func.toUpperCase();e.depthFunc(e[t])}!0===n.write?e.depthMask(!0):!1===n.write&&e.depthMask(!1)}if(E){if(!0===E.enable?e.enable(e.STENCIL_TEST):!1===E.enable&&e.disable(e.STENCIL_TEST),a(E.writeMask)&&e.stencilMask(E.writeMask),a(E.func)&&a(E.ref)&&a(E.readMask)){if(!1===function(e){return"NEVER"===(e=e.toUpperCase())||"ALWAYS"===e||"LESS"===e||"LEQUAL"===e||"NOTEQUAL"===e||"EQUAL"===e||"GREATER"===e||"GEQUAL"===e}(E.func))throw new Error("setState: stencil func is invalid, current is "+E.func+"!");const t=E.func.toUpperCase();e.stencilFunc(e[t],E.ref,E.readMask)}if(a(E.fail)&&a(E.zfail)&&a(E.zpass)){if(!1===r(E.fail)||!1===r(E.zfail)||!1===r(E.zpass))throw new Error("setState: stencil op is invalid!");const t=E.fail.toUpperCase(),n=E.zfail.toUpperCase(),a=E.zpass.toUpperCase();e.stencilOp(e[t],e[n],e[a])}}if(T&&e.colorMask(T[0],T[1],T[2],T[3]),o&&(!0===o.enable?e.enable(e.BLEND):!1===o.enable&&e.disable(e.BLEND),o.blendColor&&e.blendColor(...o.blendColor),o.blendEquation&&e.blendEquation(e[o.blendEquation.toUpperCase()]),o.blendFunc)){const t=o.blendFunc[0].toUpperCase(),r=o.blendFunc[1].toUpperCase();e.blendFunc(e[t],e[r])}if(R&&e.viewport(R[0],R[1],R[2],R[3]),c){!0===c.enable?e.enable(e.SCISSOR_TEST):!1===c.enable&&e.disable(e.SCISSOR_TEST);const t=c.rect;t&&e.scissor(t[0],t[1],t[2],t[3])}},clear:function(e,t){t=n(t,n.EMPTY_OBJECT);const{fb:r,color:E,depth:T,stencil:i}=t;e.bindFramebuffer(e.FRAMEBUFFER,r);let o=0;E&&(e.clearColor(E[0],E[1],E[2],E[3]),o|=e.COLOR_BUFFER_BIT),a(T)&&(e.clearDepth(T),o|=e.DEPTH_BUFFER_BIT),i&&(e.clearStencil(i),o|=e.STENCIL_BUFFER_BIT),0!==o&&e.clear(o)},draw:function(e,r){const{attributes:E,indices:a,vs:T,fs:s,count:_,fb:l}=r,u=n(r.primitiveType,e.TRIANGLES),A=n(r.uniforms,n.EMPTY_OBJECT);e.bindFramebuffer(e.FRAMEBUFFER,l);const U=T+s;let F=o[U];F||(F=function(e,t,r){const n=e.createShader(e.VERTEX_SHADER);e.shaderSource(n,t),e.compileShader(n);const E=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(E,r),e.compileShader(E);const a=e.createProgram();e.attachShader(a,n),e.attachShader(a,E),e.deleteShader(n),e.deleteShader(E),e.linkProgram(a);let T="";if(!e.getProgramParameter(a,e.LINK_STATUS))throw e.getShaderParameter(E,e.COMPILE_STATUS)||(T=e.getShaderInfoLog(E),console.error("Fragment shader failed to compiled: "+T)),e.getShaderParameter(n,e.COMPILE_STATUS)||(T=e.getShaderInfoLog(n),console.error("Vertex shader failed to compiled: "+T)),T=e.getProgramInfoLog(a),console.error("Shader program link log: "+T),new Error(info);return a}(e,T,s),o[U]=F),e.useProgram(F),t(e.canvas);for(const t in E)if(Object.hasOwnProperty.call(E,t)){const r=E[t],n=e.getAttribLocation(F,t);if(-1===n)continue;const a=r.toString();let T=R[a];const i=t.includes("a_position")?3:2;if(Array.isArray(r)){const t=Float32Array;T||(T=f(e,new t(r)),R[a]=T),e.bindBuffer(e.ARRAY_BUFFER,T),e.enableVertexAttribArray(n),e.vertexAttribPointer(n,i,e.FLOAT,!1,0,0)}else((d=r)instanceof Float32Array||d instanceof Uint8Array||d instanceof Uint16Array||d instanceof Uint32Array||d instanceof Int8Array||d instanceof Int16Array||d instanceof Int32Array)&&(T||(T=f(e,r),R[a]=T),e.bindBuffer(e.ARRAY_BUFFER,T),e.enableVertexAttribArray(n),e.vertexAttribPointer(n,i,e.FLOAT,!1,0,0))}var d;const b=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);let m=0;for(const t in A)if(Object.hasOwnProperty.call(A,t)){const r=A[t],n=e.getUniformLocation(F,t);if(null===n)continue;const E=typeof r,a=e.TEXTURE0+m;if(r instanceof WebGLTexture)e.activeTexture(a),e.bindTexture(e.TEXTURE_2D,r),e.uniform1i(n,m),m++;else if(P=r,Array.isArray(P)||P&&"object"==typeof P&&"number"==typeof P.length&&(0===P.length||P.length>0&&P.length-1 in P)){const t=r.length;if(t<=4)e["uniform"+t+"fv"](n,r);else if(t<=16){const E=Math.floor(Math.sqrt(t)),a=!1;e["uniformMatrix"+E+"fv"](n,a,Array.from(r))}}else if("number"===E)e.uniform1f(n,r);else if("string"===E){if(m>b){console.error("texture exceed maximum texture units.");continue}let t=c[r];if(!t){t=e.createTexture(),e.activeTexture(a),e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array([255,255,255,255]));const n=new Image;n.src=r,n.addEventListener("load",(()=>{e.activeTexture(a),e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),i(n.width)&&i(n.height)&&(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.generateMipmap(e.TEXTURE_2D))})),c[r]=t}e.activeTexture(a),e.bindTexture(e.TEXTURE_2D,t),e.uniform1i(n,m),m++}}var P;if(a&&a.length>0){let t,r,E=Number.MIN_SAFE_INTEGER;for(const e of a)E=Math.max(e,E);E<=255?(t=e.UNSIGNED_BYTE,r=Uint8Array):E<=65535?(t=e.UNSIGNED_SHORT,r=Uint16Array):(t=e.UNSIGNED_INT,r=Uint32Array,e.getExtension("OES_element_index_unit"));const T=a.toString();let i=R[T];i||(i=function(e,t,r){const E=e.createBuffer();return r=n(r,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,E),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,r),E}(e,new r(a)),R[T]=i),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i),e.drawElements(u,_,t,0)}else e.drawArrays(u,0,_)},createTexture:function(e,t){const{level:r,internalFormat:n,type:E,format:T,width:o,height:R,data:c,wrapS:f,wrapT:s,minFilter:_,magFilter:l,generateMipmap:u}=t,A=e.createTexture();return e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,A),e.texImage2D(e.TEXTURE_2D,r,n,o,R,0,T,E,c),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),a(f)&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,f),a(s)&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,s),a(_)&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,_),a(l)&&e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,l),!0===u&&(i(o)&&i(R)?e.generateMipmap(e.TEXTURE_2D):console.warn("createTexture: texture size is NOT power of two, current is "+o+"x"+R+".")),A},createFramebuffer:function(e,t){const{colorTexture:r,depthTexture:n,depthRenderbuffer:E}=t,a=e.createFramebuffer();if(e.bindFramebuffer(e.FRAMEBUFFER,a),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0),n)e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,n,0);else if(E){const t=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,t),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,E.width,E.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}const i=e.checkFramebufferStatus(e.FRAMEBUFFER);if(i!==e.FRAMEBUFFER_COMPLETE)throw new Error("createFramebuffer: framebuffer combination is NOT completed! Current status is "+T[i]+".");return a}}}();
