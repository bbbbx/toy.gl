/*
 * @license Copyright (c) 2021, Venus All Rights Reserved.
 * Available via the MIT license.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ToyGL=t()}(this,(function(){"use strict";function e(e){return null!=e}function t(e){return"KEEP"===(e=e.toUpperCase())||"ZERO"===e||"REPLACE"===e||"INCR"===e||"DECR"===e||"INVERT"===e||"INCR_WRAP"===e||"DECR_WRAP"===e}function E(t,E){const r=t[E];if(!e(r))throw new Error("gl."+E+" is not defined.");return r}function r(e,t){return null==e?t:e}r.EMPTY_OBJECT=Object.freeze({});const T=window;function a(E,r,T){if(e(T.writeMask)&&E.stencilMaskSeparate(r,T.writeMask),e(T.func)&&e(T.ref)&&e(T.valueMask)){if(!1===function(e){return"NEVER"===(e=e.toUpperCase())||"ALWAYS"===e||"LESS"===e||"LEQUAL"===e||"NOTEQUAL"===e||"EQUAL"===e||"GREATER"===e||"GEQUAL"===e}(T.func))throw new Error("setState: stencil func is invalid, current is "+T.func+"!");const e=T.func.toUpperCase();E.stencilFuncSeparate(r,E[e],T.ref,T.valueMask)}if(e(T.fail)&&e(T.zfail)&&e(T.zpass)){if(!1===t(T.fail)||!1===t(T.zfail)||!1===t(T.zpass))throw new Error("setState: stencil op is invalid, current is "+T.fail+", "+T.zfail+", "+T.zpass+"!");const e=T.fail.toUpperCase(),a=T.zfail.toUpperCase(),_=T.zpass.toUpperCase();E.stencilOpSeparate(r,E[e],E[a],E[_])}}const _={34016:"ACTIVE_TEXTURE",33984:"TEXTURE0",33985:"TEXTURE1",33986:"TEXTURE2",33987:"TEXTURE3",33988:"TEXTURE4",33989:"TEXTURE5",33990:"TEXTURE6",33991:"TEXTURE7",33992:"TEXTURE8",33993:"TEXTURE9",33994:"TEXTURE10",33995:"TEXTURE11",33996:"TEXTURE12",33997:"TEXTURE13",33998:"TEXTURE14",33999:"TEXTURE15",34e3:"TEXTURE16",34001:"TEXTURE17",34002:"TEXTURE18",34003:"TEXTURE19",34004:"TEXTURE20",34005:"TEXTURE21",34006:"TEXTURE22",34007:"TEXTURE23",34008:"TEXTURE24",34009:"TEXTURE25",34010:"TEXTURE26",34011:"TEXTURE27",34012:"TEXTURE28",34013:"TEXTURE29",34014:"TEXTURE30",34015:"TEXTURE31",3410:"RED_BITS",3411:"GREEN_BITS",3412:"BLUE_BITS",3413:"ALPHA_BITS",2884:"CULL_FACE",2885:"CULL_FACE_MODE",1028:"FRONT",1029:"BACK",1032:"FRONT_AND_BACK",512:"NEVER",513:"LESS",514:"EQUAL",515:"LEQUAL",516:"GREATER",517:"NOTEQUAL",518:"GEQUAL",519:"ALWAYS",0:"ZERO",1:"ONE",5386:"INVERT",7680:"KEEP",7681:"REPLACE",7682:"INCR",7683:"DECR",34055:"INCR_WRAP",34056:"DECR_WRAP",32774:"FUNC_ADD",32778:"FUNC_SUBTRACT",32779:"FUNC_REVERSE_SUBTRACT",768:"SRC_COLOR",770:"SRC_ALPHA",774:"DST_COLOR",772:"DST_ALPHA",32769:"CONSTANT_COLOR",32771:"CONSTANT_ALPHA",769:"ONE_MINUS_SRC_COLOR",771:"ONE_MINUS_SRC_ALPHA",775:"ONE_MINUS_DST_COLOR",773:"ONE_MINUS_DST_ALPHA",32770:"ONE_MINUS_CONSTANT_COLOR",32772:"ONE_MINUS_CONSTANT_ALPHA",2304:"CW",2305:"CCW",4352:"DONT_CARE",4353:"FASTEST",4354:"NICEST",33776:"COMPRESSED_RGB_S3TC_DXT1_EXT",33777:"COMPRESSED_RGBA_S3TC_DXT1_EXT",33778:"COMPRESSED_RGBA_S3TC_DXT3_EXT",33779:"COMPRESSED_RGBA_S3TC_DXT5_EXT",36492:"COMPRESSED_RGBA_BPTC_UNORM_EXT",36493:"COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",36494:"COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",36495:"COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",36283:"COMPRESSED_RED_RGTC1_EXT",36284:"COMPRESSED_SIGNED_RED_RGTC1_EXT",36285:"COMPRESSED_RED_GREEN_RGTC2_EXT",36286:"COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",37444:"BROWSER_DEFAULT_WEBGL",BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126};const n={36053:"FRAMEBUFFER_COMPLETE",36054:"FRAMEBUFFER_INCOMPLETE_ATTACHMENT",36055:"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",36057:"FRAMEBUFFER_INCOMPLETE_DIMENSIONS",36061:"FRAMEBUFFER_UNSUPPORTED"};function R(e){return 0==(e&e-1)}const A={};function o(e){let t;if(Array.isArray(e))t=_.UNSIGNED_SHORT;else if(e instanceof Uint8Array)t=_.UNSIGNED_BYTE;else if(e instanceof Uint16Array)t=_.UNSIGNED_SHORT;else{if(!(e instanceof Uint32Array))throw new Error("indices MUST be instance of Array, Uint8Array, Uint16Array or Uint32Array.");t=_.UNSIGNED_INT}return t}function i(e,t,E,r){const T=e.createBuffer();return e.bindBuffer(t,T),e.bufferData(t,E,r),e.bindBuffer(t,null),T}function S(e,t,E){const T=t.toString();let a,_=A[T];if(_)return _;if(E=r(E,e.STATIC_DRAW),Array.isArray(t))a=new Float32Array(t);else{if(!((n=t)instanceof Float32Array||n instanceof Uint8Array||n instanceof Uint16Array||n instanceof Uint32Array||n instanceof Int8Array||n instanceof Int16Array||n instanceof Int32Array))throw new Error("Buffer data"+t+"must be TypedArray or Array ");a=t}var n;return _=i(e,e.ARRAY_BUFFER,a,E),A[T]=_,_}function s(e,t,E){const T=t.toString();let a,_=A[T];if(_)return _;E=r(E,e.STATIC_DRAW);const n=o(t);if(n===e.UNSIGNED_BYTE)a=new Uint8Array(t);else if(n===e.UNSIGNED_SHORT)a=new Uint16Array(t);else{if(n!==e.UNSIGNED_INT)throw new Error("Buffer data must be TypedArray or Array ");a=new Uint32Array(t),e.getExtension("OES_element_index_unit")}return _=i(e,e.ELEMENT_ARRAY_BUFFER,a,E),A[T]=_,_}const N={},U={};function P(e){let t=0;switch(e){case 5126:t=1;break;case 35664:t=2;break;case 35665:t=3;break;case 35666:t=4;break;default:throw new Error("Unrecognize "+e+" type.")}return t}function I(e){const{name:t,size:E,type:r}=e;let T=0;switch(r){case 5126:T=1*E;break;case 35664:T=2*E;break;case 35665:T=3*E;break;case 35666:case 35674:T=4*E;break;case 35675:T=9*E;break;case 35676:T=16*E;break;default:console.warn(`Can not recognize attribute ${t} type, current type is ${r}`)}return T}return{createContext:function(e){let t,E=(e=r(e,r.EMPTY_OBJECT)).canvas;return E||(E=T.document.createElement("canvas"),E.style.width="100vw",E.style.height="100vh",E.style.setProperty("display","block"),E.width=window.innerWidth,E.height=window.innerHeight),t=e.requireWebgl2?E.getContext("webgl2",e):E.getContext("webgl",e),t},setState:function(t,r){const{depthTest:T,stencilTest:_,colorMask:n,cull:R,blend:A,viewport:o,scissor:i,polygonOffset:S,sampleCoverage:s,dither:N}=r;if(R){R.enable?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE);const E=R.face&&R.face.toUpperCase();"BACK"!==E&&"FRONT"!==E&&"FRONT_AND_BACK"!==E||t.cullFace(t[E]);let r=e(R.frontFace)&&R.frontFace.toUpperCase();"CCW"!==r&&"CW"!==r||t.frontFace(t[r])}if(T){if(!0===T.enable?t.enable(t.DEPTH_TEST):!1===T.enable&&t.disable(t.DEPTH_TEST),T.func){const e=T.func.toUpperCase();t.depthFunc(t[e])}!0===T.write?t.depthMask(!0):!1===T.write&&t.depthMask(!1)}if(_){!0===_.enable?t.enable(t.STENCIL_TEST):!1===_.enable&&t.disable(t.STENCIL_TEST);const{front:e,back:E}=_;e&&a(t,t.FRONT,e),E&&a(t,t.BACK,E)}if(n&&t.colorMask(n[0],n[1],n[2],n[3]),A){if(!0===A.enable?t.enable(t.BLEND):!1===A.enable&&t.disable(t.BLEND),A.blendColor&&t.blendColor(...A.blendColor),A.blendEquationSeparate){const{rgb:E,alpha:r}=A.blendEquationSeparate;if(!e(E)||!e(r))throw new Error("To use blendEquationSeparate you MUST specify rgb and alpha.");const T=E.toUpperCase(),a=r.toUpperCase(),_=t[T],n=t[a];if(!e(_))throw new Error("gl."+T+" is undefined.");if(!e(n))throw new Error("gl."+a+" is undefined.");t.blendEquationSeparate(_,n)}else if(A.blendEquation){const E=A.blendEquation.toUpperCase(),r=t[E];if(!e(r))throw new Error(E+" is invalid.");t.blendEquation(r)}const r=A.blendFuncSeparate;if(e(r)){const{srcRGB:T,dstRGB:a,srcAlpha:_,dstAlpha:n}=r;if(!e(T))throw new Error("To use blendFuncSeparate you MUST specify srcRGB property.");if(!e(a))throw new Error("To use blendFuncSeparate you MUST specify dstRGB property.");if(!e(_))throw new Error("To use blendFuncSeparate you MUST specify srcAlpha property.");if(!e(n))throw new Error("To use blendFuncSeparate you MUST specify dstAlpha property.");const R=T.toUpperCase(),A=a.toUpperCase(),o=_.toUpperCase(),i=n.toUpperCase(),S=E(t,R),s=E(t,A),N=E(t,o),U=E(t,i);t.blendFuncSeparate(S,s,N,U)}else if(e(A.blendFunc)){const e=A.blendFunc[0].toUpperCase(),r=A.blendFunc[1].toUpperCase(),T=E(t,e),a=E(t,r);t.blendFunc(T,a)}}if(o&&t.viewport(o[0],o[1],o[2],o[3]),i){!0===i.enable?t.enable(t.SCISSOR_TEST):!1===i.enable&&t.disable(t.SCISSOR_TEST);const e=i.rect;e&&t.scissor(e[0],e[1],e[2],e[3])}if(e(S)&&(!0===S.enable?t.enable(t.POLYGON_OFFSET_FILL):!1===S.enable?t.disable(t.POLYGON_OFFSET_FILL):console.warn("polygonOffset.enable MUST be either true or false, current is "+S.enable.toString()+"."),t.polygonOffset(S.factor,S.units)),e(s)){const{alphaToCoverage:E,value:r,invert:T,enable:a}=s;!0===E?t.enable(t.SAMPLE_ALPHA_TO_COVERAGE):!1===E&&t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),!0===a?t.enable(t.SAMPLE_COVERAGE):!1===a&&t.disable(t.SAMPLE_COVERAGE),e(r)&&e(T)&&(!0!==T&&!1!==T&&console.warn("sampleCoverage.invert MUST be boolean."),t.sampleCoverage(r,T))}e(N)&&(!0===N?t.enable(t.DITHER):!1===N?t.disable(t.DITHER):console.warn("setState: dither MUST be a boolean value, otherwise it will be ignored."))},getState:function(e){const t=e.getParameter(e.CULL_FACE),E=e.getParameter(e.CULL_FACE_MODE),r=e.getParameter(e.DEPTH_TEST),T=e.getParameter(e.DEPTH_CLEAR_VALUE),a=e.getParameter(e.DEPTH_FUNC),n=e.getParameter(e.DEPTH_WRITEMASK),R=e.getParameter(e.DEPTH_RANGE),A=e.getParameter(e.DEPTH_BITS),o=e.getParameter(e.STENCIL_TEST),i=e.getParameter(e.STENCIL_CLEAR_VALUE),S=e.getParameter(e.STENCIL_REF),s=e.getParameter(e.STENCIL_FUNC),N=e.getParameter(e.STENCIL_FAIL),U=e.getParameter(e.STENCIL_PASS_DEPTH_FAIL),P=e.getParameter(e.STENCIL_PASS_DEPTH_PASS),I=e.getParameter(e.STENCIL_VALUE_MASK),C=e.getParameter(e.STENCIL_WRITEMASK),c=e.getParameter(e.STENCIL_BACK_REF),L=e.getParameter(e.STENCIL_BACK_FUNC),f=e.getParameter(e.STENCIL_BACK_FAIL),l=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_FAIL),u=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_PASS),O=e.getParameter(e.STENCIL_BACK_VALUE_MASK),D=e.getParameter(e.STENCIL_BACK_WRITEMASK),B=e.getParameter(e.STENCIL_BITS),M=e.getParameter(e.BLEND),F=e.getParameter(e.BLEND_COLOR),m=e.getParameter(e.BLEND_DST_RGB),g=e.getParameter(e.BLEND_DST_ALPHA),d=e.getParameter(e.BLEND_SRC_RGB),b=e.getParameter(e.BLEND_SRC_ALPHA),X=e.getParameter(e.BLEND_EQUATION_RGB),G=e.getParameter(e.BLEND_EQUATION_ALPHA),p=e.getParameter(e.VIEWPORT),x=e.getParameter(e.MAX_VIEWPORT_DIMS),h=e.getParameter(e.SCISSOR_TEST),y=e.getParameter(e.SCISSOR_BOX),w=e.getParameter(e.POLYGON_OFFSET_FILL),H=e.getParameter(e.POLYGON_OFFSET_FACTOR),V=e.getParameter(e.POLYGON_OFFSET_UNITS),W=e.getParameter(e.DITHER),v=e.getParameter(e.RED_BITS),Y=e.getParameter(e.GREEN_BITS),K=e.getParameter(e.BLUE_BITS),k=e.getParameter(e.ALPHA_BITS),z=e.getParameter(e.SUBPIXEL_BITS),Q=e.getParameter(e.ALIASED_LINE_WIDTH_RANGE),Z=e.getParameter(e.ALIASED_POINT_SIZE_RANGE),j=e.getParameter(e.COLOR_WRITEMASK),q=e.getParameter(e.COLOR_CLEAR_VALUE),J=e.getParameter(e.ACTIVE_TEXTURE),$=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),ee=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),te=e.getParameter(e.MAX_TEXTURE_SIZE),Ee=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),re=e.getParameter(e.MAX_RENDERBUFFER_SIZE),Te=e.getParameter(e.MAX_VERTEX_ATTRIBS),ae=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),_e=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),ne=e.getParameter(e.MAX_VARYING_VECTORS),Re=e.getParameter(e.PACK_ALIGNMENT),Ae=e.getParameter(e.UNPACK_ALIGNMENT),oe=e.getParameter(e.UNPACK_COLORSPACE_CONVERSION_WEBGL),ie=e.getParameter(e.UNPACK_FLIP_Y_WEBGL),Se=e.getParameter(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL),se=e.getParameter(e.VENDOR),Ne=e.getParameter(e.VERSION),Ue=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),Pe=e.getParameter(e.CURRENT_PROGRAM),Ie=e.getParameter(e.ARRAY_BUFFER_BINDING),Ce=e.getParameter(e.ELEMENT_ARRAY_BUFFER_BINDING),ce=e.getParameter(e.FRAMEBUFFER_BINDING),Le=e.getParameter(e.RENDERBUFFER_BINDING),fe=e.getParameter(e.TEXTURE_BINDING_2D),le=e.getParameter(e.TEXTURE_BINDING_CUBE_MAP),ue=e.getParameter(e.RENDERER),Oe=e.getParameter(e.SAMPLES),De=e.getParameter(e.SAMPLE_BUFFERS),Be=e.getParameter(e.SAMPLE_ALPHA_TO_COVERAGE),Me=e.getParameter(e.SAMPLE_COVERAGE_INVERT),Fe=e.getParameter(e.SAMPLE_COVERAGE_VALUE),me=e.getParameter(e.FRONT_FACE),ge=e.getParameter(e.LINE_WIDTH),de=e.getParameter(e.GENERATE_MIPMAP_HINT),be=e.getParameter(e.SHADING_LANGUAGE_VERSION);return{cullFace:{CULL_FACE:t,CULL_FACE_MODE:_[E]},depth:{DEPTH_TEST:r,DEPTH_CLEAR_VALUE:T,DEPTH_FUNC:_[a],DEPTH_WRITEMASK:n,DEPTH_RANGE:R,DEPTH_BITS:A},stencil:{STENCIL_TEST:o,STENCIL_CLEAR_VALUE:i,STENCIL_BITS:B,front:{STENCIL_REF:S,STENCIL_FUNC:_[s],STENCIL_FAIL:_[N],STENCIL_PASS_DEPTH_FAIL:_[U],STENCIL_PASS_DEPTH_PASS:_[P],STENCIL_VALUE_MASK:Number(I).toString(16),STENCIL_WRITEMASK:Number(C).toString(16)},back:{STENCIL_BACK_REF:c,STENCIL_BACK_FUNC:_[L],STENCIL_BACK_FAIL:_[f],STENCIL_BACK_PASS_DEPTH_FAIL:_[l],STENCIL_BACK_PASS_DEPTH_PASS:_[u],STENCIL_BACK_VALUE_MASK:Number(O).toString(16),STENCIL_BACK_WRITEMASK:Number(D).toString(16)}},blend:{BLEND:M,BLEND_COLOR:F,BLEND_DST_RGB:_[m],BLEND_DST_ALPHA:_[g],BLEND_SRC_RGB:_[d],BLEND_SRC_ALPHA:_[b],BLEND_EQUATION_RGB:_[X],BLEND_EQUATION_ALPHA:_[G]},viewport:{VIEWPORT:p,MAX_VIEWPORT_DIMS:x},scissor:{SCISSOR_TEST:h,SCISSOR_BOX:y},polygonOffset:{POLYGON_OFFSET_FILL:w,POLYGON_OFFSET_FACTOR:H,POLYGON_OFFSET_UNITS:V},DITHER:W,binding:{ARRAY_BUFFER_BINDING:Ie,ELEMENT_ARRAY_BUFFER_BINDING:Ce,CURRENT_PROGRAM:Pe,FRAMEBUFFER_BINDING:ce,RENDERBUFFER_BINDING:Le,TEXTURE_BINDING_2D:fe,TEXTURE_BINDING_CUBE:le},RENDERER:ue,color:{RED_BITS:v,GREEN_BITS:Y,BLUE_BITS:K,ALPHA_BITS:k,SUBPIXEL_BITS:z,COLOR_CLEAR_VALUE:q,COLOR_WRITEMASK:j},aliasedRange:{ALIASED_LINE_WIDTH_RANGE:Q,ALIASED_POINT_SIZE_RANGE:Z},texture:{MAX_TEXTURE_IMAGE_UNITS:$,MAX_COMBINED_TEXTURE_IMAGE_UNITS:ee,ACTIVE_TEXTURE:_[J],MAX_TEXTURE_SIZE:te,MAX_CUBE_MAP_TEXTURE_SIZE:Ee,MAX_RENDERBUFFER_SIZE:re},COMPRESSED_TEXTURE_FORMATS:Array.from(Ue).map((e=>_[e])),GENERATE_MIPMAP_HINT:_[de],LINE_WIDTH:ge,FRONT_FACE:_[me],SHADING_LANGUAGE_VERSION:be,vertex:{MAX_VERTEX_ATTRIBS:Te,MAX_VERTEX_TEXTURE_IMAGE_UNITS:ae,MAX_VERTEX_UNIFORM_VECTORS:_e,MAX_VARYING_VECTORS:ne},sample:{SAMPLES:Oe,SAMPLE_BUFFERS:De,SAMPLE_ALPHA_TO_COVERAGE:Be,SAMPLE_COVERAGE_VALUE:Fe,SAMPLE_COVERAGE_INVERT:Me},unpack:{PACK_ALIGNMENT:Re,UNPACK_ALIGNMENT:Ae,UNPACK_FLIP_Y_WEBGL:ie,UNPACK_PREMULTIPLY_ALPHA_WEBGL:Se,UNPACK_COLORSPACE_CONVERSION_WEBGL:_[oe]},VENDOR:se,VERSION:Ne}},clear:function(t,E){E=r(E,r.EMPTY_OBJECT);const{fb:T,color:a,depth:_,stencil:n}=E;t.bindFramebuffer(t.FRAMEBUFFER,T);let R=0;a&&(t.clearColor(a[0],a[1],a[2],a[3]),R|=t.COLOR_BUFFER_BIT),e(_)&&(t.clearDepth(_),R|=t.DEPTH_BUFFER_BIT),n&&(t.clearStencil(n),R|=t.STENCIL_BUFFER_BIT),0!==R&&t.clear(R)},draw:function(t,E){const{attributes:T,indices:a,vao:_,vs:n,fs:R,attributeLocations:A,fb:i}=E;let C=E.count;if(!e(C)&&e(a)&&(C=a.length),!e(C))throw new Error("vertices count or indices is not defined.");if(e(_)&&!e(A))throw new Error("To use vao, you must defined attributeLocations.");const c=r(E.primitiveType,t.TRIANGLES),L=r(E.uniforms,r.EMPTY_OBJECT);t.bindFramebuffer(t.FRAMEBUFFER,i);const f=n+R;let l=N[f];l||(l=function(t,E,r,T){const a=t.createShader(t.VERTEX_SHADER);t.shaderSource(a,E),t.compileShader(a);const _=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(_,r),t.compileShader(_);const n=t.createProgram();if(t.attachShader(n,a),t.attachShader(n,_),t.deleteShader(a),t.deleteShader(_),e(T))for(const e in T)if(Object.hasOwnProperty.call(T,e)){const E=T[e];t.bindAttribLocation(n,E,e)}t.linkProgram(n);let R="";return t.getProgramParameter(n,t.LINK_STATUS)||(t.getShaderParameter(_,t.COMPILE_STATUS)||(R=t.getShaderInfoLog(_),console.error("Fragment shader failed to compiled: "+R)),t.getShaderParameter(a,t.COMPILE_STATUS)||(R=t.getShaderInfoLog(a),console.error("Vertex shader failed to compiled: "+R)),R=t.getProgramInfoLog(n),console.error("Shader program link log: "+R)),n}(t,n,R,A),N[f]=l),t.useProgram(l);const u=t.getProgramParameter(l,t.ACTIVE_ATTRIBUTES),O=t.getExtension("OES_vertex_array_object");if(e(_))if(O)O.bindVertexArrayOES(_);else{if(!(t instanceof WebGL2RenderingContext))throw new Error("this branch never should be executed.");t.bindVertexArray(_)}else{if(!e(T))throw new Error("vao or attributes must be defined.");O&&O.bindVertexArrayOES(null);for(let e=0;e<u;e++){const E=t.getActiveAttrib(l,e),r=E.name;if(Object.hasOwnProperty.call(T,r)){const e=T[r],a=t.getAttribLocation(l,r);if(-1===a)continue;const _=I(E),n=S(t,e,t.STATIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,n),t.enableVertexAttribArray(a),t.vertexAttribPointer(a,_,t.FLOAT,!1,0,0)}}}const D=t.getProgramParameter(l,t.ACTIVE_UNIFORMS),B=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);let M=0;for(let e=0;e<D;e++){const E=t.getActiveUniform(l,e);let r=E.name,T=!1;const a=r.indexOf("[");if(a>=0&&(r=r.slice(0,a),T=!0),Object.hasOwnProperty.call(L,r)){const e=L[r],a=t.getUniformLocation(l,r);if(null===a)continue;if(T){const r=P(E.type);t["uniform"+r+"fv"](a,Array.from(e));continue}const _=typeof e,n=t.TEXTURE0+M;if(e instanceof WebGLTexture){if(t.activeTexture(n),E.type===t.SAMPLER_2D)t.bindTexture(t.TEXTURE_2D,e);else{if(E.type!==t.SAMPLER_CUBE)throw new Error(E,"type MUST be SAMPLER_2D or SAMPLER_CUBE");t.bindTexture(t.TEXTURE_CUBE_MAP,e)}t.uniform1i(a,M),M++}else if(F=e,Array.isArray(F)||F&&"object"==typeof F&&"number"==typeof F.length&&(0===F.length||F.length>0&&F.length-1 in F)){const E=e.length;if(E<=4)t["uniform"+E+"fv"](a,e);else if(E<=16){const r=Math.floor(Math.sqrt(E)),T=!1;t["uniformMatrix"+r+"fv"](a,T,Array.from(e))}}else if("number"===_)t.uniform1f(a,e);else if("string"===_){if(M>B){console.error("texture exceed maximum texture units.");continue}let E=U[e];if(!E){E=t.createTexture(),t.activeTexture(n),t.bindTexture(t.TEXTURE_2D,E),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([255,255,255,255]));const r=new Image;r.src=e,r.addEventListener("load",(()=>{t.activeTexture(n),t.bindTexture(t.TEXTURE_2D,E),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)})),U[e]=E}t.activeTexture(n),t.bindTexture(t.TEXTURE_2D,E),t.uniform1i(a,M),M++}}}var F;const m=t.getParameter(t.ELEMENT_ARRAY_BUFFER_BINDING);if(a&&a.length>0){const e=s(t,a,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e);const E=o(a);t.drawElements(c,C,E,0)}else O&&t.getParameter(O.VERTEX_ARRAY_BINDING_OES)&&m?t.drawElements(c,C,t.UNSIGNED_SHORT,0):t.drawArrays(c,0,C)},createTexture:function(e,t){const{internalFormat:E,type:T,format:a,width:_,height:n,data:A,generateMipmap:o}=t,i=r(t.wrapS,e.CLAMP_TO_EDGE),S=r(t.wrapT,e.CLAMP_TO_EDGE),s=r(t.minFilter,e.LINEAR),N=r(t.magFilter,e.LINEAR);let U=t.levels;U||(U=[A]);const P=r(t.flipY,!1),I=r(t.premultiplyAlpha,!1);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,P),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,I);const C=e.createTexture();e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,C),(E===e.DEPTH_COMPONENT||e.DEPTH_STENCIL)&&e.getExtension("WEBGL_depth_texture"),T===e.FLOAT&&(e.getExtension("OES_texture_float"),s!==e.LINEAR&&s!==e.LINEAR_MIPMAP_NEAREST&&s!==e.NEAREST_MIPMAP_LINEAR&&s!==e.LINEAR_MIPMAP_LINEAR||e.getExtension("OES_texture_float_linear"));const c=U.length;for(let t=0;t<c;t++){const r=U[t];if(r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement)e.texImage2D(e.TEXTURE_2D,t,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r);else{const R=0;e.texImage2D(e.TEXTURE_2D,t,E,_,n,R,a,T,r)}}return e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,S),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,N),!0===o&&(R(_)&&R(n)?e.generateMipmap(e.TEXTURE_2D):console.warn("createTexture: texture size is NOT power of two, current is "+_+"x"+n+".")),e.bindTexture(e.TEXTURE_2D,null),C},updateTexture:function(e,t,E){if(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t),E instanceof HTMLImageElement||E instanceof HTMLCanvasElement||E instanceof HTMLVideoElement)e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,videoElem);else{const{width:t,height:T,arrayBufferView:a}=E,_=r(E.level,0),n=r(E.internalFormat,e.RGBA),R=r(E.format,e.RGBA),A=r(E.internalFormat,e.UNSIGNED_BYTE),o=0;e.texImage2D(e.TEXTURE_2D,_,n,t,T,o,R,A,a)}return e.bindTexture(e.TEXTURE_2D,null),t},createCubeMap:function(e,t){t=r(t,r.EMPTY_OBJECT);const E=r(t.level,0),T=t.data,a=t.width,_=t.height,n=r(t.format,e.RGBA),R=r(t.type,e.UNSIGNED_BYTE),A=r(t.internalFormat,e.RGBA),o=e.createTexture();e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,o);const i=[{target:e.TEXTURE_CUBE_MAP_POSITIVE_X,data:T.px},{target:e.TEXTURE_CUBE_MAP_NEGATIVE_X,data:T.nx},{target:e.TEXTURE_CUBE_MAP_POSITIVE_Y,data:T.py},{target:e.TEXTURE_CUBE_MAP_NEGATIVE_Y,data:T.ny},{target:e.TEXTURE_CUBE_MAP_POSITIVE_Z,data:T.pz},{target:e.TEXTURE_CUBE_MAP_NEGATIVE_Z,data:T.nz}];for(let t=0;t<6;t++){const r=i[t],T=r.target,o=r.data;o instanceof HTMLImageElement?e.texImage2D(T,E,A,n,R,o):e.texImage2D(T,E,A,a,_,0,n,R,o),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR)}return e.bindTexture(e.TEXTURE_CUBE_MAP,null),o},createVAO:function(t,E){let r,T;if(t instanceof WebGLRenderingContext){if(r=t.getExtension("OES_vertex_array_object"),!r)throw new Error("Your device does not support VAO(OES_vertex_array_object extension), try to use vertex attributes.");T=r.createVertexArrayOES(),r.bindVertexArrayOES(T)}else{if(!(t instanceof WebGL2RenderingContext))throw new Error("gl MUST be instance of WebGLRenderingContext or WebGL2RenderingContext.");T=t.createVertexArray(),t.bindVertexArray(T)}const a=E.attributes,_=E.indices;for(const e in a)if(Object.hasOwnProperty.call(a,e)){const{location:E,data:r,size:T}=a[e],_=S(t,r,t.STATIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,_),t.enableVertexAttribArray(E);const n=t.FLOAT,R=!1,A=0,o=0;t.vertexAttribPointer(E,T,n,R,A,o)}if(e(_)){const e=s(t,_,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e)}return t instanceof WebGLRenderingContext?r.bindVertexArrayOES(null):t instanceof WebGL2RenderingContext&&t.bindVertexArray(null),T},createFramebuffer:function(e,t){const{colorTexture:E,depthTexture:T,depthRenderbuffer:a}=t,_=r(t.colorAttachments,[E]),R=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,R),e.activeTexture(e.TEXTURE0);const A=_.length;if(A>1){const t=e.getExtension("WebGL_draw_buffers"),E=[];for(let e=0;e<A;e++)E.push(t.COLOR_ATTACHMENT0_WEBGL+e);t.drawBuffersWEBGL(E);for(let t=0;t<A;t++){const E=_[t];e.bindTexture(e.TEXTURE_2D,E),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,E,0)}}else e.bindTexture(e.TEXTURE_2D,E),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,E,0);if(e.bindTexture(e.TEXTURE_2D,null),T)e.bindTexture(e.TEXTURE_2D,T),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,T,0),e.bindTexture(e.TEXTURE_2D,null);else if(a){const t=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,t),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,a.width,a.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),e.bindRenderbuffer(e.RENDERBUFFER,null)}const o=e.checkFramebufferStatus(e.FRAMEBUFFER);if(o!==e.FRAMEBUFFER_COMPLETE)throw new Error("createFramebuffer: framebuffer combination is NOT completed! Current status is "+n[o]+".");return R}}}));
//# sourceMappingURL=toygl.min.js.map
