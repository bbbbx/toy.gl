/*
 * @license Copyright (c) 2021, Venus All Rights Reserved.
 * Available via the MIT license.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ToyGL=t()}(this,(function(){"use strict";function e(e){return null!=e}function t(e){return"KEEP"===(e=e.toUpperCase())||"ZERO"===e||"REPLACE"===e||"INCR"===e||"DECR"===e||"INVERT"===e||"INCR_WRAP"===e||"DECR_WRAP"===e}function E(t,E){const r=t[E];if(!e(r))throw new Error("gl."+E+" is not defined.");return r}function r(e,t){return null==e?t:e}r.EMPTY_OBJECT=Object.freeze({});const a=window;function T(E,r,a){if(e(a.writeMask)&&E.stencilMaskSeparate(r,a.writeMask),e(a.func)&&e(a.ref)&&e(a.valueMask)){if(!1===function(e){return"NEVER"===(e=e.toUpperCase())||"ALWAYS"===e||"LESS"===e||"LEQUAL"===e||"NOTEQUAL"===e||"EQUAL"===e||"GREATER"===e||"GEQUAL"===e}(a.func))throw new Error("setState: stencil func is invalid, current is "+a.func+"!");const e=a.func.toUpperCase();E.stencilFuncSeparate(r,E[e],a.ref,a.valueMask)}if(e(a.fail)&&e(a.zfail)&&e(a.zpass)){if(!1===t(a.fail)||!1===t(a.zfail)||!1===t(a.zpass))throw new Error("setState: stencil op is invalid, current is "+a.fail+", "+a.zfail+", "+a.zpass+"!");const e=a.fail.toUpperCase(),T=a.zfail.toUpperCase(),_=a.zpass.toUpperCase();E.stencilOpSeparate(r,E[e],E[T],E[_])}}const _={34016:"ACTIVE_TEXTURE",33984:"TEXTURE0",33985:"TEXTURE1",33986:"TEXTURE2",33987:"TEXTURE3",33988:"TEXTURE4",33989:"TEXTURE5",33990:"TEXTURE6",33991:"TEXTURE7",33992:"TEXTURE8",33993:"TEXTURE9",33994:"TEXTURE10",33995:"TEXTURE11",33996:"TEXTURE12",33997:"TEXTURE13",33998:"TEXTURE14",33999:"TEXTURE15",34e3:"TEXTURE16",34001:"TEXTURE17",34002:"TEXTURE18",34003:"TEXTURE19",34004:"TEXTURE20",34005:"TEXTURE21",34006:"TEXTURE22",34007:"TEXTURE23",34008:"TEXTURE24",34009:"TEXTURE25",34010:"TEXTURE26",34011:"TEXTURE27",34012:"TEXTURE28",34013:"TEXTURE29",34014:"TEXTURE30",34015:"TEXTURE31",3410:"RED_BITS",3411:"GREEN_BITS",3412:"BLUE_BITS",3413:"ALPHA_BITS",2884:"CULL_FACE",2885:"CULL_FACE_MODE",1028:"FRONT",1029:"BACK",1032:"FRONT_AND_BACK",512:"NEVER",513:"LESS",514:"EQUAL",515:"LEQUAL",516:"GREATER",517:"NOTEQUAL",518:"GEQUAL",519:"ALWAYS",0:"ZERO",1:"ONE",5386:"INVERT",7680:"KEEP",7681:"REPLACE",7682:"INCR",7683:"DECR",34055:"INCR_WRAP",34056:"DECR_WRAP",32774:"FUNC_ADD",32778:"FUNC_SUBTRACT",32779:"FUNC_REVERSE_SUBTRACT",768:"SRC_COLOR",770:"SRC_ALPHA",774:"DST_COLOR",772:"DST_ALPHA",32769:"CONSTANT_COLOR",32771:"CONSTANT_ALPHA",769:"ONE_MINUS_SRC_COLOR",771:"ONE_MINUS_SRC_ALPHA",775:"ONE_MINUS_DST_COLOR",773:"ONE_MINUS_DST_ALPHA",32770:"ONE_MINUS_CONSTANT_COLOR",32772:"ONE_MINUS_CONSTANT_ALPHA",2304:"CW",2305:"CCW",4352:"DONT_CARE",4353:"FASTEST",4354:"NICEST",33776:"COMPRESSED_RGB_S3TC_DXT1_EXT",33777:"COMPRESSED_RGBA_S3TC_DXT1_EXT",33778:"COMPRESSED_RGBA_S3TC_DXT3_EXT",33779:"COMPRESSED_RGBA_S3TC_DXT5_EXT",36492:"COMPRESSED_RGBA_BPTC_UNORM_EXT",36493:"COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",36494:"COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",36495:"COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",36283:"COMPRESSED_RED_RGTC1_EXT",36284:"COMPRESSED_SIGNED_RED_RGTC1_EXT",36285:"COMPRESSED_RED_GREEN_RGTC2_EXT",36286:"COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",37444:"BROWSER_DEFAULT_WEBGL"};const n={36053:"FRAMEBUFFER_COMPLETE",36054:"FRAMEBUFFER_INCOMPLETE_ATTACHMENT",36055:"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",36057:"FRAMEBUFFER_INCOMPLETE_DIMENSIONS",36061:"FRAMEBUFFER_UNSUPPORTED"};function R(e){return 0==(e&e-1)}const A={};function o(e){let t;if(Array.isArray(e))t=gl.UNSIGNED_SHORT;else if(e instanceof Uint8Array)t=gl.UNSIGNED_BYTE;else if(e instanceof Uint16Array)t=gl.UNSIGNED_SHORT;else{if(!(e instanceof Uint32Array))throw new Error("indices MUST be instance of Array, Uint8Array, Uint16Array or Uint32Array.");t=gl.UNSIGNED_INT}return t}function i(e,t,E,r){const a=e.createBuffer();return e.bindBuffer(t,a),e.bufferData(t,E,r),e.bindBuffer(t,null),a}function S(e,t,E){const a=t.toString();let T,_=A[a];if(_)return _;if(E=r(E,e.STATIC_DRAW),Array.isArray(t))T=new Float32Array(t);else{if(!((n=t)instanceof Float32Array||n instanceof Uint8Array||n instanceof Uint16Array||n instanceof Uint32Array||n instanceof Int8Array||n instanceof Int16Array||n instanceof Int32Array))throw new Error("Buffer data"+t+"must be TypedArray or Array ");T=t}var n;return _=i(e,e.ARRAY_BUFFER,T,E),A[a]=_,_}function s(e,t,E){const a=t.toString();let T,_=A[a];if(_)return _;E=r(E,e.STATIC_DRAW);const n=o(t);if(n===e.UNSIGNED_BYTE)T=new Uint8Array(t);else if(n===e.UNSIGNED_SHORT)T=new Uint16Array(t);else{if(n!==e.UNSIGNED_INT)throw new Error("Buffer data must be TypedArray or Array ");T=new Uint32Array(t),e.getExtension("OES_element_index_unit")}return _=i(e,e.ELEMENT_ARRAY_BUFFER,T,E),A[a]=_,_}const U={},P={};function N(e){let t=0;switch(e){case 5126:t=1;break;case 35664:t=2;break;case 35665:t=3;break;case 35666:t=4;break;default:throw new Error("Unrecognize "+e+" type.")}return t}function C(e){const{name:t,size:E,type:r}=e;let a=0;switch(r){case 5126:a=1*E;break;case 35664:a=2*E;break;case 35665:a=3*E;break;case 35666:case 35674:a=4*E;break;case 35675:a=9*E;break;case 35676:a=16*E;break;default:console.warn(`Can not recognize attribute ${t} type, current type is ${r}`)}return a}return{createContext:function(e){let t,E=(e=r(e,r.EMPTY_OBJECT)).canvas;return E||(E=a.document.createElement("canvas"),E.style.width="100vw",E.style.height="100vh",E.style.setProperty("display","block"),E.width=window.innerWidth,E.height=window.innerHeight),t=e.requireWebgl2?E.getContext("webgl2",e):E.getContext("webgl",e),t},setState:function(t,r){const{cull:a,depthTest:_,stencilTest:n,colorMask:R,blend:A,viewport:o,depthRange:i,scissor:S,polygonOffset:s,sampleCoverage:U,dither:P}=r;if(a){a.enable?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE);const E=a.face&&a.face.toUpperCase();"BACK"!==E&&"FRONT"!==E&&"FRONT_AND_BACK"!==E||t.cullFace(t[E]);let r=e(a.frontFace)&&a.frontFace.toUpperCase();"CCW"!==r&&"CW"!==r||t.frontFace(t[r])}if(_){if(!0===_.enable?t.enable(t.DEPTH_TEST):!1===_.enable&&t.disable(t.DEPTH_TEST),_.func){const e=_.func.toUpperCase();t.depthFunc(t[e])}!0===_.write?t.depthMask(!0):!1===_.write&&t.depthMask(!1)}if(n){!0===n.enable?t.enable(t.STENCIL_TEST):!1===n.enable&&t.disable(t.STENCIL_TEST);const{front:e,back:E}=n;e&&T(t,t.FRONT,e),E&&T(t,t.BACK,E)}if(R&&t.colorMask(R[0],R[1],R[2],R[3]),A){if(!0===A.enable?t.enable(t.BLEND):!1===A.enable&&t.disable(t.BLEND),A.blendColor&&t.blendColor(...A.blendColor),A.blendEquationSeparate){const{rgb:E,alpha:r}=A.blendEquationSeparate;if(!e(E)||!e(r))throw new Error("To use blendEquationSeparate you MUST specify rgb and alpha.");const a=E.toUpperCase(),T=r.toUpperCase(),_=t[a],n=t[T];if(!e(_))throw new Error("gl."+a+" is undefined.");if(!e(n))throw new Error("gl."+T+" is undefined.");t.blendEquationSeparate(_,n)}else if(A.blendEquation){const E=A.blendEquation.toUpperCase(),r=t[E];if(!e(r))throw new Error(E+" is invalid.");t.blendEquation(r)}const r=A.blendFuncSeparate;if(e(r)){const{srcRGB:a,dstRGB:T,srcAlpha:_,dstAlpha:n}=r;if(!e(a))throw new Error("To use blendFuncSeparate you MUST specify srcRGB property.");if(!e(T))throw new Error("To use blendFuncSeparate you MUST specify dstRGB property.");if(!e(_))throw new Error("To use blendFuncSeparate you MUST specify srcAlpha property.");if(!e(n))throw new Error("To use blendFuncSeparate you MUST specify dstAlpha property.");const R=a.toUpperCase(),A=T.toUpperCase(),o=_.toUpperCase(),i=n.toUpperCase(),S=E(t,R),s=E(t,A),U=E(t,o),P=E(t,i);t.blendFuncSeparate(S,s,U,P)}else if(e(A.blendFunc)){const e=A.blendFunc[0].toUpperCase(),r=A.blendFunc[1].toUpperCase(),a=E(t,e),T=E(t,r);t.blendFunc(a,T)}}if(o&&t.viewport(o[0],o[1],o[2],o[3]),i&&t.depthRange(i[0],i[1]),S){!0===S.enable?t.enable(t.SCISSOR_TEST):!1===S.enable&&t.disable(t.SCISSOR_TEST);const e=S.rect;e&&t.scissor(e[0],e[1],e[2],e[3])}if(e(s)&&(!0===s.enable?t.enable(t.POLYGON_OFFSET_FILL):!1===s.enable?t.disable(t.POLYGON_OFFSET_FILL):console.warn("polygonOffset.enable MUST be either true or false, current is "+s.enable.toString()+"."),t.polygonOffset(s.factor,s.units)),e(U)){const{alphaToCoverage:E,value:r,invert:a,enable:T}=U;!0===E?t.enable(t.SAMPLE_ALPHA_TO_COVERAGE):!1===E&&t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),!0===T?t.enable(t.SAMPLE_COVERAGE):!1===T&&t.disable(t.SAMPLE_COVERAGE),e(r)&&e(a)&&(!0!==a&&!1!==a&&console.warn("sampleCoverage.invert MUST be boolean."),t.sampleCoverage(r,a))}e(P)&&(!0===P?t.enable(t.DITHER):!1===P?t.disable(t.DITHER):console.warn("setState: dither MUST be a boolean value, otherwise it will be ignored."))},getState:function(e){const t=e.getParameter(e.CULL_FACE),E=e.getParameter(e.CULL_FACE_MODE),r=e.getParameter(e.DEPTH_TEST),a=e.getParameter(e.DEPTH_CLEAR_VALUE),T=e.getParameter(e.DEPTH_FUNC),n=e.getParameter(e.DEPTH_WRITEMASK),R=e.getParameter(e.DEPTH_RANGE),A=e.getParameter(e.DEPTH_BITS),o=e.getParameter(e.STENCIL_TEST),i=e.getParameter(e.STENCIL_CLEAR_VALUE),S=e.getParameter(e.STENCIL_REF),s=e.getParameter(e.STENCIL_FUNC),U=e.getParameter(e.STENCIL_FAIL),P=e.getParameter(e.STENCIL_PASS_DEPTH_FAIL),N=e.getParameter(e.STENCIL_PASS_DEPTH_PASS),C=e.getParameter(e.STENCIL_VALUE_MASK),c=e.getParameter(e.STENCIL_WRITEMASK),I=e.getParameter(e.STENCIL_BACK_REF),L=e.getParameter(e.STENCIL_BACK_FUNC),f=e.getParameter(e.STENCIL_BACK_FAIL),l=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_FAIL),u=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_PASS),O=e.getParameter(e.STENCIL_BACK_VALUE_MASK),D=e.getParameter(e.STENCIL_BACK_WRITEMASK),M=e.getParameter(e.STENCIL_BITS),B=e.getParameter(e.BLEND),F=e.getParameter(e.BLEND_COLOR),g=e.getParameter(e.BLEND_DST_RGB),m=e.getParameter(e.BLEND_DST_ALPHA),d=e.getParameter(e.BLEND_SRC_RGB),b=e.getParameter(e.BLEND_SRC_ALPHA),X=e.getParameter(e.BLEND_EQUATION_RGB),G=e.getParameter(e.BLEND_EQUATION_ALPHA),p=e.getParameter(e.VIEWPORT),h=e.getParameter(e.MAX_VIEWPORT_DIMS),x=e.getParameter(e.SCISSOR_TEST),y=e.getParameter(e.SCISSOR_BOX),w=e.getParameter(e.POLYGON_OFFSET_FILL),H=e.getParameter(e.POLYGON_OFFSET_FACTOR),V=e.getParameter(e.POLYGON_OFFSET_UNITS),W=e.getParameter(e.DITHER),v=e.getParameter(e.RED_BITS),K=e.getParameter(e.GREEN_BITS),Y=e.getParameter(e.BLUE_BITS),k=e.getParameter(e.ALPHA_BITS),z=e.getParameter(e.SUBPIXEL_BITS),Q=e.getParameter(e.ALIASED_LINE_WIDTH_RANGE),Z=e.getParameter(e.ALIASED_POINT_SIZE_RANGE),j=e.getParameter(e.COLOR_WRITEMASK),q=e.getParameter(e.COLOR_CLEAR_VALUE),J=e.getParameter(e.ACTIVE_TEXTURE),$=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),ee=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),te=e.getParameter(e.MAX_TEXTURE_SIZE),Ee=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),re=e.getParameter(e.MAX_RENDERBUFFER_SIZE),ae=e.getParameter(e.MAX_VERTEX_ATTRIBS),Te=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),_e=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),ne=e.getParameter(e.MAX_VARYING_VECTORS),Re=e.getParameter(e.PACK_ALIGNMENT),Ae=e.getParameter(e.UNPACK_ALIGNMENT),oe=e.getParameter(e.UNPACK_COLORSPACE_CONVERSION_WEBGL),ie=e.getParameter(e.UNPACK_FLIP_Y_WEBGL),Se=e.getParameter(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL),se=e.getParameter(e.VENDOR),Ue=e.getParameter(e.VERSION),Pe=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),Ne=e.getParameter(e.CURRENT_PROGRAM),Ce=e.getParameter(e.ARRAY_BUFFER_BINDING),ce=e.getParameter(e.ELEMENT_ARRAY_BUFFER_BINDING),Ie=e.getParameter(e.FRAMEBUFFER_BINDING),Le=e.getParameter(e.RENDERBUFFER_BINDING),fe=e.getParameter(e.TEXTURE_BINDING_2D),le=e.getParameter(e.TEXTURE_BINDING_CUBE_MAP),ue=e.getParameter(e.RENDERER),Oe=e.getParameter(e.SAMPLES),De=e.getParameter(e.SAMPLE_BUFFERS),Me=e.getParameter(e.SAMPLE_ALPHA_TO_COVERAGE),Be=e.getParameter(e.SAMPLE_COVERAGE_INVERT),Fe=e.getParameter(e.SAMPLE_COVERAGE_VALUE),ge=e.getParameter(e.FRONT_FACE),me=e.getParameter(e.LINE_WIDTH),de=e.getParameter(e.GENERATE_MIPMAP_HINT),be=e.getParameter(e.SHADING_LANGUAGE_VERSION);return{cullFace:{CULL_FACE:t,CULL_FACE_MODE:_[E]},depth:{DEPTH_TEST:r,DEPTH_CLEAR_VALUE:a,DEPTH_FUNC:_[T],DEPTH_WRITEMASK:n,DEPTH_RANGE:R,DEPTH_BITS:A},stencil:{STENCIL_TEST:o,STENCIL_CLEAR_VALUE:i,STENCIL_BITS:M,front:{STENCIL_REF:S,STENCIL_FUNC:_[s],STENCIL_FAIL:_[U],STENCIL_PASS_DEPTH_FAIL:_[P],STENCIL_PASS_DEPTH_PASS:_[N],STENCIL_VALUE_MASK:Number(C).toString(16),STENCIL_WRITEMASK:Number(c).toString(16)},back:{STENCIL_BACK_REF:I,STENCIL_BACK_FUNC:_[L],STENCIL_BACK_FAIL:_[f],STENCIL_BACK_PASS_DEPTH_FAIL:_[l],STENCIL_BACK_PASS_DEPTH_PASS:_[u],STENCIL_BACK_VALUE_MASK:Number(O).toString(16),STENCIL_BACK_WRITEMASK:Number(D).toString(16)}},blend:{BLEND:B,BLEND_COLOR:F,BLEND_DST_RGB:_[g],BLEND_DST_ALPHA:_[m],BLEND_SRC_RGB:_[d],BLEND_SRC_ALPHA:_[b],BLEND_EQUATION_RGB:_[X],BLEND_EQUATION_ALPHA:_[G]},viewport:{VIEWPORT:p,MAX_VIEWPORT_DIMS:h},scissor:{SCISSOR_TEST:x,SCISSOR_BOX:y},polygonOffset:{POLYGON_OFFSET_FILL:w,POLYGON_OFFSET_FACTOR:H,POLYGON_OFFSET_UNITS:V},DITHER:W,binding:{ARRAY_BUFFER_BINDING:Ce,ELEMENT_ARRAY_BUFFER_BINDING:ce,CURRENT_PROGRAM:Ne,FRAMEBUFFER_BINDING:Ie,RENDERBUFFER_BINDING:Le,TEXTURE_BINDING_2D:fe,TEXTURE_BINDING_CUBE:le},RENDERER:ue,color:{RED_BITS:v,GREEN_BITS:K,BLUE_BITS:Y,ALPHA_BITS:k,SUBPIXEL_BITS:z,COLOR_CLEAR_VALUE:q,COLOR_WRITEMASK:j},aliasedRange:{ALIASED_LINE_WIDTH_RANGE:Q,ALIASED_POINT_SIZE_RANGE:Z},texture:{MAX_TEXTURE_IMAGE_UNITS:$,MAX_COMBINED_TEXTURE_IMAGE_UNITS:ee,ACTIVE_TEXTURE:_[J],MAX_TEXTURE_SIZE:te,MAX_CUBE_MAP_TEXTURE_SIZE:Ee,MAX_RENDERBUFFER_SIZE:re},COMPRESSED_TEXTURE_FORMATS:Array.from(Pe).map((e=>_[e])),GENERATE_MIPMAP_HINT:_[de],LINE_WIDTH:me,FRONT_FACE:_[ge],SHADING_LANGUAGE_VERSION:be,vertex:{MAX_VERTEX_ATTRIBS:ae,MAX_VERTEX_TEXTURE_IMAGE_UNITS:Te,MAX_VERTEX_UNIFORM_VECTORS:_e,MAX_VARYING_VECTORS:ne},sample:{SAMPLES:Oe,SAMPLE_BUFFERS:De,SAMPLE_ALPHA_TO_COVERAGE:Me,SAMPLE_COVERAGE_VALUE:Fe,SAMPLE_COVERAGE_INVERT:Be},unpack:{PACK_ALIGNMENT:Re,UNPACK_ALIGNMENT:Ae,UNPACK_FLIP_Y_WEBGL:ie,UNPACK_PREMULTIPLY_ALPHA_WEBGL:Se,UNPACK_COLORSPACE_CONVERSION_WEBGL:_[oe]},VENDOR:se,VERSION:Ue}},clear:function(t,E){E=r(E,r.EMPTY_OBJECT);const{fb:a,color:T,depth:_,stencil:n}=E;t.bindFramebuffer(t.FRAMEBUFFER,a);let R=0;T&&(t.clearColor(T[0],T[1],T[2],T[3]),R|=t.COLOR_BUFFER_BIT),e(_)&&(t.clearDepth(_),R|=t.DEPTH_BUFFER_BIT),n&&(t.clearStencil(n),R|=t.STENCIL_BUFFER_BIT),0!==R&&t.clear(R)},draw:function(t,E){const{attributes:a,indices:T,vao:_,vs:n,fs:R,attributeLocations:A,fb:i}=E;let c=E.count;if(!e(c)&&e(T)&&(c=T.length),!e(c))throw new Error("vertices count or indices is not defined.");if(e(_)&&!e(A))throw new Error("To use vao, you must defined attributeLocations.");const I=r(E.primitiveType,t.TRIANGLES),L=r(E.uniforms,r.EMPTY_OBJECT);t.bindFramebuffer(t.FRAMEBUFFER,i);const f=n+R;let l=U[f];l||(l=function(t,E,r,a){const T=t.createShader(t.VERTEX_SHADER);t.shaderSource(T,E),t.compileShader(T);const _=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(_,r),t.compileShader(_);const n=t.createProgram();if(t.attachShader(n,T),t.attachShader(n,_),t.deleteShader(T),t.deleteShader(_),e(a))for(const e in a)if(Object.hasOwnProperty.call(a,e)){const E=a[e];t.bindAttribLocation(n,E,e)}t.linkProgram(n);let R="";return t.getProgramParameter(n,t.LINK_STATUS)||(t.getShaderParameter(_,t.COMPILE_STATUS)||(R=t.getShaderInfoLog(_),console.error("Fragment shader failed to compiled: "+R)),t.getShaderParameter(T,t.COMPILE_STATUS)||(R=t.getShaderInfoLog(T),console.error("Vertex shader failed to compiled: "+R)),R=t.getProgramInfoLog(n),console.error("Shader program link log: "+R)),n}(t,n,R,A),U[f]=l),t.useProgram(l);const u=t.getProgramParameter(l,t.ACTIVE_ATTRIBUTES),O=t.getExtension("OES_vertex_array_object");if(e(_))if(O)O.bindVertexArrayOES(_);else{if(!(t instanceof WebGL2RenderingContext))throw new Error("this branch never should be executed.");t.bindVertexArray(_)}else{if(!e(a))throw new Error("vao or attributes must be defined.");O&&O.bindVertexArrayOES(null);for(let e=0;e<u;e++){const E=t.getActiveAttrib(l,e),r=E.name;if(Object.hasOwnProperty.call(a,r)){const e=a[r],T=t.getAttribLocation(l,r);if(-1===T)continue;const _=C(E),n=S(t,e,t.STATIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,n),t.enableVertexAttribArray(T),t.vertexAttribPointer(T,_,t.FLOAT,!1,0,0)}}}const D=t.getProgramParameter(l,t.ACTIVE_UNIFORMS),M=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);let B=0;for(let e=0;e<D;e++){const E=t.getActiveUniform(l,e);let r=E.name,a=!1;const T=r.indexOf("[");if(T>=0&&(r=r.slice(0,T),a=!0),Object.hasOwnProperty.call(L,r)){const e=L[r],T=t.getUniformLocation(l,r);if(null===T)continue;if(a){const r=N(E.type);t["uniform"+r+"fv"](T,Array.from(e));continue}const _=typeof e,n=t.TEXTURE0+B;if(e instanceof WebGLTexture){if(t.activeTexture(n),E.type===t.SAMPLER_2D)t.bindTexture(t.TEXTURE_2D,e);else{if(E.type!==t.SAMPLER_CUBE)throw new Error(E,"type MUST be SAMPLER_2D or SAMPLER_CUBE");t.bindTexture(t.TEXTURE_CUBE_MAP,e)}t.uniform1i(T,B),B++}else if(F=e,Array.isArray(F)||F&&"object"==typeof F&&"number"==typeof F.length&&(0===F.length||F.length>0&&F.length-1 in F)){const E=e.length;if(E<=4)t["uniform"+E+"fv"](T,e);else if(E<=16){const r=Math.floor(Math.sqrt(E)),a=!1;t["uniformMatrix"+r+"fv"](T,a,Array.from(e))}}else if("number"===_)t.uniform1f(T,e);else if("string"===_){if(B>M){console.error("texture exceed maximum texture units.");continue}let E=P[e];if(!E){E=t.createTexture(),t.activeTexture(n),t.bindTexture(t.TEXTURE_2D,E),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([255,255,255,255]));const r=new Image;r.src=e,r.addEventListener("load",(()=>{t.activeTexture(n),t.bindTexture(t.TEXTURE_2D,E),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)})),P[e]=E}t.activeTexture(n),t.bindTexture(t.TEXTURE_2D,E),t.uniform1i(T,B),B++}}}var F;const g=t.getParameter(t.ELEMENT_ARRAY_BUFFER_BINDING);if(T&&T.length>0){const e=s(t,T,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e);const E=o(T);t.drawElements(I,c,E,0)}else g?t.drawElements(I,c,t.UNSIGNED_SHORT,0):t.drawArrays(I,0,c)},createTexture:function(e,t){const{internalFormat:E,type:a,format:T,width:_,height:n,data:A,generateMipmap:o}=t,i=r(t.wrapS,e.CLAMP_TO_EDGE),S=r(t.wrapT,e.CLAMP_TO_EDGE),s=r(t.minFilter,e.LINEAR),U=r(t.magFilter,e.LINEAR);let P=t.levels;P||(P=[A]);const N=e.createTexture();e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,N),(E===e.DEPTH_COMPONENT||e.DEPTH_STENCIL)&&e.getExtension("WEBGL_depth_texture"),a===e.FLOAT&&(e.getExtension("OES_texture_float"),s!==e.LINEAR&&s!==e.LINEAR_MIPMAP_NEAREST&&s!==e.NEAREST_MIPMAP_LINEAR&&s!==e.LINEAR_MIPMAP_LINEAR||e.getExtension("OES_texture_float_linear"));const C=P.length;for(let t=0;t<C;t++){const r=P[t];if(r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement)e.texImage2D(e.TEXTURE_2D,t,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r);else{const R=0;e.texImage2D(e.TEXTURE_2D,t,E,_,n,R,T,a,r)}}return e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,S),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,U),!0===o&&(R(_)&&R(n)?e.generateMipmap(e.TEXTURE_2D):console.warn("createTexture: texture size is NOT power of two, current is "+_+"x"+n+".")),e.bindTexture(e.TEXTURE_2D,null),N},updateTexture:function(e,t,E){if(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t),E instanceof HTMLImageElement||E instanceof HTMLCanvasElement||E instanceof HTMLVideoElement)e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,videoElem);else{const{width:t,height:a,arrayBufferView:T}=E,_=r(E.level,0),n=r(E.internalFormat,e.RGBA),R=r(E.format,e.RGBA),A=r(E.internalFormat,e.UNSIGNED_BYTE),o=0;e.texImage2D(e.TEXTURE_2D,_,n,t,a,o,R,A,T)}return e.bindTexture(e.TEXTURE_2D,null),t},createCubeMap:function(e,t){t=r(t,r.EMPTY_OBJECT);const E=r(t.level,0),a=t.data,T=t.width,_=t.height,n=r(t.format,e.RGBA),R=r(t.type,e.UNSIGNED_BYTE),A=r(t.internalFormat,e.RGBA),o=e.createTexture();e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,o);const i=[{target:e.TEXTURE_CUBE_MAP_POSITIVE_X,data:a.px},{target:e.TEXTURE_CUBE_MAP_NEGATIVE_X,data:a.nx},{target:e.TEXTURE_CUBE_MAP_POSITIVE_Y,data:a.py},{target:e.TEXTURE_CUBE_MAP_NEGATIVE_Y,data:a.ny},{target:e.TEXTURE_CUBE_MAP_POSITIVE_Z,data:a.pz},{target:e.TEXTURE_CUBE_MAP_NEGATIVE_Z,data:a.nz}];for(let t=0;t<6;t++){const r=i[t],a=r.target,o=r.data;o instanceof HTMLImageElement?e.texImage2D(a,E,A,n,R,o):e.texImage2D(a,E,A,T,_,0,n,R,o),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR)}return e.bindTexture(e.TEXTURE_CUBE_MAP,null),o},createVAO:function(t,E){let r,a;if(t instanceof WebGLRenderingContext){if(r=t.getExtension("OES_vertex_array_object"),!r)throw new Error("Your device does not support VAO(OES_vertex_array_object extension), try to use vertex attributes.");a=r.createVertexArrayOES(),r.bindVertexArrayOES(a)}else{if(!(t instanceof WebGL2RenderingContext))throw new Error("gl MUST be instance of WebGLRenderingContext or WebGL2RenderingContext.");a=t.createVertexArray(),t.bindVertexArray(a)}const T=E.attributes,_=E.indices;for(const e in T)if(Object.hasOwnProperty.call(T,e)){const{location:E,data:r,size:a}=T[e],_=S(t,r,t.STATIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,_),t.enableVertexAttribArray(E);const n=t.FLOAT,R=!1,A=0,o=0;t.vertexAttribPointer(E,a,n,R,A,o)}if(e(_)){const e=s(t,_,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e)}return t instanceof WebGLRenderingContext?r.bindVertexArrayOES(null):t instanceof WebGL2RenderingContext&&t.bindVertexArray(null),a},createFramebuffer:function(e,t){const{colorTexture:E,depthTexture:a,depthRenderbuffer:T}=t,_=r(t.colorAttachments,[E]),R=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,R),e.activeTexture(e.TEXTURE0);const A=_.length;if(A>1){const t=e.getExtension("WebGL_draw_buffers"),E=[];for(let e=0;e<A;e++)E.push(t.COLOR_ATTACHMENT0_WEBGL+e);t.drawBuffersWEBGL(E);for(let t=0;t<A;t++){const E=_[t];e.bindTexture(e.TEXTURE_2D,E),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,E,0)}}else e.bindTexture(e.TEXTURE_2D,E),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,E,0);if(e.bindTexture(e.TEXTURE_2D,null),a)e.bindTexture(e.TEXTURE_2D,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0),e.bindTexture(e.TEXTURE_2D,null);else if(T){const t=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,t),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,T.width,T.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),e.bindRenderbuffer(e.RENDERBUFFER,null)}const o=e.checkFramebufferStatus(e.FRAMEBUFFER);if(o!==e.FRAMEBUFFER_COMPLETE)throw new Error("createFramebuffer: framebuffer combination is NOT completed! Current status is "+n[o]+".");return R}}}));
//# sourceMappingURL=toygl.min.js.map
