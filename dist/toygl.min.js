/*
 * @license Copyright (c) 2021, Venus All Rights Reserved.
 * Available via the MIT license.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ToyGL=t()}(this,(function(){"use strict";function e(e,t){return null==e?t:e}e.EMPTY_OBJECT=Object.freeze({});const t=window;function E(e){return null!=e}function r(e){return"KEEP"===(e=e.toUpperCase())||"ZERO"===e||"REPLACE"===e||"INCR"===e||"DECR"===e||"INVERT"===e||"INCR_WRAP"===e||"DECR_WRAP"===e}function _(e,t){const r=e[t];if(!E(r))throw new Error("gl."+t+" is not defined.");return r}function T(e,t,_){if(E(_.writeMask)&&e.stencilMaskSeparate(t,_.writeMask),E(_.func)&&E(_.ref)&&E(_.valueMask)){if(!1===function(e){return"NEVER"===(e=e.toUpperCase())||"ALWAYS"===e||"LESS"===e||"LEQUAL"===e||"NOTEQUAL"===e||"EQUAL"===e||"GREATER"===e||"GEQUAL"===e}(_.func))throw new Error("setState: stencil func is invalid, current is "+_.func+"!");const E=_.func.toUpperCase();e.stencilFuncSeparate(t,e[E],_.ref,_.valueMask)}if(E(_.fail)&&E(_.zfail)&&E(_.zpass)){if(!1===r(_.fail)||!1===r(_.zfail)||!1===r(_.zpass))throw new Error("setState: stencil op is invalid, current is "+_.fail+", "+_.zfail+", "+_.zpass+"!");const E=_.fail.toUpperCase(),T=_.zfail.toUpperCase(),a=_.zpass.toUpperCase();e.stencilOpSeparate(t,e[E],e[T],e[a])}}const a={34016:"ACTIVE_TEXTURE",33984:"TEXTURE0",33985:"TEXTURE1",33986:"TEXTURE2",33987:"TEXTURE3",33988:"TEXTURE4",33989:"TEXTURE5",33990:"TEXTURE6",33991:"TEXTURE7",33992:"TEXTURE8",33993:"TEXTURE9",33994:"TEXTURE10",33995:"TEXTURE11",33996:"TEXTURE12",33997:"TEXTURE13",33998:"TEXTURE14",33999:"TEXTURE15",34e3:"TEXTURE16",34001:"TEXTURE17",34002:"TEXTURE18",34003:"TEXTURE19",34004:"TEXTURE20",34005:"TEXTURE21",34006:"TEXTURE22",34007:"TEXTURE23",34008:"TEXTURE24",34009:"TEXTURE25",34010:"TEXTURE26",34011:"TEXTURE27",34012:"TEXTURE28",34013:"TEXTURE29",34014:"TEXTURE30",34015:"TEXTURE31",3410:"RED_BITS",3411:"GREEN_BITS",3412:"BLUE_BITS",3413:"ALPHA_BITS",2884:"CULL_FACE",2885:"CULL_FACE_MODE",1028:"FRONT",1029:"BACK",1032:"FRONT_AND_BACK",512:"NEVER",513:"LESS",514:"EQUAL",515:"LEQUAL",516:"GREATER",517:"NOTEQUAL",518:"GEQUAL",519:"ALWAYS",0:"ZERO",1:"ONE",5386:"INVERT",7680:"KEEP",7681:"REPLACE",7682:"INCR",7683:"DECR",34055:"INCR_WRAP",34056:"DECR_WRAP",32774:"FUNC_ADD",32778:"FUNC_SUBTRACT",32779:"FUNC_REVERSE_SUBTRACT",768:"SRC_COLOR",770:"SRC_ALPHA",774:"DST_COLOR",772:"DST_ALPHA",32769:"CONSTANT_COLOR",32771:"CONSTANT_ALPHA",769:"ONE_MINUS_SRC_COLOR",771:"ONE_MINUS_SRC_ALPHA",775:"ONE_MINUS_DST_COLOR",773:"ONE_MINUS_DST_ALPHA",32770:"ONE_MINUS_CONSTANT_COLOR",32772:"ONE_MINUS_CONSTANT_ALPHA",2304:"CW",2305:"CCW",4352:"DONT_CARE",4353:"FASTEST",4354:"NICEST",33776:"COMPRESSED_RGB_S3TC_DXT1_EXT",33777:"COMPRESSED_RGBA_S3TC_DXT1_EXT",33778:"COMPRESSED_RGBA_S3TC_DXT3_EXT",33779:"COMPRESSED_RGBA_S3TC_DXT5_EXT",36492:"COMPRESSED_RGBA_BPTC_UNORM_EXT",36493:"COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",36494:"COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",36495:"COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",36283:"COMPRESSED_RED_RGTC1_EXT",36284:"COMPRESSED_SIGNED_RED_RGTC1_EXT",36285:"COMPRESSED_RED_GREEN_RGTC2_EXT",36286:"COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",37444:"BROWSER_DEFAULT_WEBGL",BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126};const n={36053:"FRAMEBUFFER_COMPLETE",36054:"FRAMEBUFFER_INCOMPLETE_ATTACHMENT",36055:"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",36057:"FRAMEBUFFER_INCOMPLETE_DIMENSIONS",36061:"FRAMEBUFFER_UNSUPPORTED"};function A(e){return 0==(e&e-1)}const R={};function o(e){let t,E=e[0];for(let t=1;t<e.length;t++)E=Math.max(E,e[t]);return t=E<=255?a.UNSIGNED_BYTE:E<=65535?a.UNSIGNED_SHORT:a.UNSIGNED_INT,t}function i(e,t,E,r){const _=e.createBuffer();return e.bindBuffer(t,_),e.bufferData(t,E,r),e.bindBuffer(t,null),_}function S(t,E,r){let _="";for(const e of E){if(_.length>1e6)break;_+=`${e.toFixed(3)},`}let T,a=R[_];if(a)return a;if(r=e(r,t.STATIC_DRAW),Array.isArray(E))T=new Float32Array(E);else{if(!((n=E)instanceof Float32Array||n instanceof Uint8Array||n instanceof Uint16Array||n instanceof Uint32Array||n instanceof Int8Array||n instanceof Int16Array||n instanceof Int32Array))throw new Error("Buffer data"+E+"must be TypedArray or Array ");T=E}var n;return a=i(t,t.ARRAY_BUFFER,T,r),R[_]=a,a}function s(t,E,r){const _=E.toString();let T,a=R[_];if(a)return a;r=e(r,t.STATIC_DRAW);const n=o(E);if(n===t.UNSIGNED_BYTE)T=new Uint8Array(E);else if(n===t.UNSIGNED_SHORT)T=new Uint16Array(E);else{if(n!==t.UNSIGNED_INT)throw new Error("Buffer data must be TypedArray or Array ");T=new Uint32Array(E),t.getExtension("OES_element_index_unit")}return a=i(t,t.ELEMENT_ARRAY_BUFFER,T,r),a.indicesType=n,R[_]=a,a}function N(e,t){if(!e.createVertexArray)return;const r=e.getParameter(e.VERTEX_ARRAY_BINDING),_=e.createVertexArray();e.bindVertexArray(_);const T=t.attributes,a=t.indices;for(const t in T)if(Object.hasOwnProperty.call(T,t)){const{location:E,data:r,size:_}=T[t],a=S(e,r,e.STATIC_DRAW);e.bindBuffer(e.ARRAY_BUFFER,a),e.enableVertexAttribArray(E);const n=e.FLOAT,A=!1,R=0,o=0;e.vertexAttribPointer(E,_,n,A,R,o)}if(E(a)){const t=s(e,a,e.STATIC_DRAW);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t)}return e.bindVertexArray(r),_}const I={},c={};function U(e){let t=0;switch(e){case 5126:t=1;break;case 35664:t=2;break;case 35665:t=3;break;case 35666:case 35674:t=4;break;case 35675:t=9;break;case 35676:t=16;break;default:throw new Error("Unrecognize "+e+" type.")}return t}function P(e){const{name:t,size:E,type:r}=e;return E*U(r)}const L={};return{createContext:function(E){let r,_=(E=e(E,e.EMPTY_OBJECT)).canvas;if(_||(_=t.document.createElement("canvas"),_.style.width="100vw",_.style.height="100vh",_.style.setProperty("display","block"),_.width=window.innerWidth,_.height=window.innerHeight),r=E.requireWebgl2?_.getContext("webgl2",E):_.getContext("webgl",E),!r.createVertexArray){const e=r.getExtension("OES_vertex_array_object");e&&(r.createVertexArray=e.createVertexArrayOES.bind(e),r.bindVertexArray=e.bindVertexArrayOES.bind(e),r.deleteVertexArray=e.deleteVertexArrayOES.bind(e),r.isVertexArray=e.isVertexArrayOES.bind(e),r.VERTEX_ARRAY_BINDING=e.VERTEX_ARRAY_BINDING_OES)}if(!r.drawArraysInstanced){const e=r.getExtension("ANGLE_instanced_arrays");e&&(r.drawArraysInstanced=e.drawArraysInstancedANGLE.bind(e),r.drawElementsInstanced=e.drawElementsInstancedANGLE.bind(e),r.vertexAttribDivisor=e.vertexAttribDivisorANGLE.bind(e),r.VERTEX_ATTRIB_ARRAY_DIVISOR=e.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)}if(!r.drawBuffers){const e=r.getExtension("WEBGL_draw_buffers");if(e){r.drawBuffers=e.drawBuffersWEBGL.bind(e);for(let t=1;t<=15;t++)r[`COLOR_ATTACHMENT${t}`]=e[`COLOR_ATTACHMENT${t}_WEBGL`],r[`DRAW_BUFFER${t}`]=e[`DRAW_BUFFER${t}_WEBGL`];r.MAX_COLOR_ATTACHMENTS=e.MAX_COLOR_ATTACHMENTS_WEBGL,r.MAX_DRAW_BUFFERS=e.MAX_DRAW_BUFFERS_WEBGL,r.MAX_DRAW_BUFFERS=e.MAX_DRAW_BUFFERS_WEBGL}}if(!r.MAX_TEXTURE_MAX_ANISOTROPY){const e=r.getExtension("EXT_texture_filter_anisotropic");e&&(r.MAX_TEXTURE_MAX_ANISOTROPY=e.MAX_TEXTURE_MAX_ANISOTROPY_EXT,r.TEXTURE_MAX_ANISOTROPY=e.TEXTURE_MAX_ANISOTROPY_EXT)}if(!r.MIN){const e=r.getExtension("EXT_blend_minmax");e&&(r.MIN=e.MIN_EXT,r.MAX=e.MAX_EXT)}if(!r.FRAGMENT_SHADER_DERIVATIVE_HINT){const e=r.getExtension("OES_standard_derivatives");e&&(r.FRAGMENT_SHADER_DERIVATIVE_HINT=e.FRAGMENT_SHADER_DERIVATIVE_HINT_OES)}if(!r.UNSIGNED_INT_24_8){const e=r.getExtension("WEBGL_depth_texture");e&&(r.UNSIGNED_INT_24_8=e.UNSIGNED_INT_24_8_WEBGL)}if(!r.HALF_FLOAT){const e=r.getExtension("OES_texture_half_float");e&&(r.HALF_FLOAT=e.HALF_FLOAT_OES)}return r.extS3tc=r.getExtension("WEBGL_compressed_texture_s3tc"),r.extPvrtc=r.getExtension("WEBGL_compressed_texture_pvrtc"),r.extAstc=r.getExtension("WEBGL_compressed_texture_astc"),r.extEtc=r.getExtension("WEBG_compressed_texture_etc"),r.extEtc1=r.getExtension("WEBG_compressed_texture_etc1"),r.extBc7=r.getExtension("EXT_texture_compression_bptc"),r.extDebugShaders=r.getExtension("WEBGL_debug_shaders"),r._elementIndexUint=!!r.getExtension("OES_element_index_uint"),r._fragDepth=!!r.getExtension("EXT_frag_depth"),r._textureFloat=!!r.getExtension("OES_texture_float"),r._textureFloatLinear=!!r.getExtension("OES_texture_float_linear"),r._colorBufferFloat=!!r.getExtension("EXT_color_buffer_float"),r._colorBufferHalfFloat=!!r.getExtension("EXT_color_buffer_half_float"),r._floatBlend=!!r.getExtension("EXT_float_blend"),r._shaderTextureLod=!!r.getExtension("EXT_shader_texture_lod"),r},setState:function(e,t){const{depthTest:r,stencilTest:a,colorMask:n,cull:A,blend:R,viewport:o,scissor:i,polygonOffset:S,sampleCoverage:s,dither:N}=t;if(A){A.enable?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE);const t=A.face&&A.face.toUpperCase();"BACK"!==t&&"FRONT"!==t&&"FRONT_AND_BACK"!==t||e.cullFace(e[t]);let r=E(A.frontFace)&&A.frontFace.toUpperCase();"CCW"!==r&&"CW"!==r||e.frontFace(e[r])}if(r){if(!0===r.enable?e.enable(e.DEPTH_TEST):!1===r.enable&&e.disable(e.DEPTH_TEST),r.func){const t=r.func.toUpperCase();e.depthFunc(e[t])}!0===r.write?e.depthMask(!0):!1===r.write&&e.depthMask(!1)}if(a){!0===a.enable?e.enable(e.STENCIL_TEST):!1===a.enable&&e.disable(e.STENCIL_TEST);const{front:t,back:E}=a;t&&T(e,e.FRONT,t),E&&T(e,e.BACK,E)}if(n&&e.colorMask(n[0],n[1],n[2],n[3]),R){if(!0===R.enable?e.enable(e.BLEND):!1===R.enable&&e.disable(e.BLEND),R.blendColor&&e.blendColor(...R.blendColor),R.blendEquationSeparate){const{rgb:t,alpha:r}=R.blendEquationSeparate;if(!E(t)||!E(r))throw new Error("To use blendEquationSeparate you MUST specify rgb and alpha.");const _=t.toUpperCase(),T=r.toUpperCase(),a=e[_],n=e[T];if(!E(a))throw new Error("gl."+_+" is undefined.");if(!E(n))throw new Error("gl."+T+" is undefined.");e.blendEquationSeparate(a,n)}else if(R.blendEquation){const t=R.blendEquation.toUpperCase(),r=e[t];if(!E(r))throw new Error(t+" is invalid.");e.blendEquation(r)}const t=R.blendFuncSeparate;if(E(t)){const{srcRGB:r,dstRGB:T,srcAlpha:a,dstAlpha:n}=t;if(!E(r))throw new Error("To use blendFuncSeparate you MUST specify srcRGB property.");if(!E(T))throw new Error("To use blendFuncSeparate you MUST specify dstRGB property.");if(!E(a))throw new Error("To use blendFuncSeparate you MUST specify srcAlpha property.");if(!E(n))throw new Error("To use blendFuncSeparate you MUST specify dstAlpha property.");const A=r.toUpperCase(),R=T.toUpperCase(),o=a.toUpperCase(),i=n.toUpperCase(),S=_(e,A),s=_(e,R),N=_(e,o),I=_(e,i);e.blendFuncSeparate(S,s,N,I)}else if(E(R.blendFunc)){const t=R.blendFunc[0].toUpperCase(),E=R.blendFunc[1].toUpperCase(),r=_(e,t),T=_(e,E);e.blendFunc(r,T)}}if(o&&e.viewport(o[0],o[1],o[2],o[3]),i){!0===i.enable?e.enable(e.SCISSOR_TEST):!1===i.enable&&e.disable(e.SCISSOR_TEST);const t=i.rect;t&&e.scissor(t[0],t[1],t[2],t[3])}if(E(S)&&(!0===S.enable?e.enable(e.POLYGON_OFFSET_FILL):!1===S.enable?e.disable(e.POLYGON_OFFSET_FILL):console.warn("polygonOffset.enable MUST be either true or false, current is "+S.enable.toString()+"."),e.polygonOffset(S.factor,S.units)),E(s)){const{alphaToCoverage:t,value:r,invert:_,enable:T}=s;!0===t?e.enable(e.SAMPLE_ALPHA_TO_COVERAGE):!1===t&&e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),!0===T?e.enable(e.SAMPLE_COVERAGE):!1===T&&e.disable(e.SAMPLE_COVERAGE),E(r)&&E(_)&&(!0!==_&&!1!==_&&console.warn("sampleCoverage.invert MUST be boolean."),e.sampleCoverage(r,_))}E(N)&&(!0===N?e.enable(e.DITHER):!1===N?e.disable(e.DITHER):console.warn("setState: dither MUST be a boolean value, otherwise it will be ignored."))},getState:function(e){const t=e.getParameter(e.CULL_FACE),E=e.getParameter(e.CULL_FACE_MODE),r=e.getParameter(e.DEPTH_TEST),_=e.getParameter(e.DEPTH_CLEAR_VALUE),T=e.getParameter(e.DEPTH_FUNC),n=e.getParameter(e.DEPTH_WRITEMASK),A=e.getParameter(e.DEPTH_RANGE),R=e.getParameter(e.DEPTH_BITS),o=e.getParameter(e.STENCIL_TEST),i=e.getParameter(e.STENCIL_CLEAR_VALUE),S=e.getParameter(e.STENCIL_REF),s=e.getParameter(e.STENCIL_FUNC),N=e.getParameter(e.STENCIL_FAIL),I=e.getParameter(e.STENCIL_PASS_DEPTH_FAIL),c=e.getParameter(e.STENCIL_PASS_DEPTH_PASS),U=e.getParameter(e.STENCIL_VALUE_MASK),P=e.getParameter(e.STENCIL_WRITEMASK),L=e.getParameter(e.STENCIL_BACK_REF),f=e.getParameter(e.STENCIL_BACK_FUNC),l=e.getParameter(e.STENCIL_BACK_FAIL),C=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_FAIL),u=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_PASS),O=e.getParameter(e.STENCIL_BACK_VALUE_MASK),B=e.getParameter(e.STENCIL_BACK_WRITEMASK),D=e.getParameter(e.STENCIL_BITS),M=e.getParameter(e.BLEND),d=e.getParameter(e.BLEND_COLOR),F=e.getParameter(e.BLEND_DST_RGB),m=e.getParameter(e.BLEND_DST_ALPHA),g=e.getParameter(e.BLEND_SRC_RGB),X=e.getParameter(e.BLEND_SRC_ALPHA),b=e.getParameter(e.BLEND_EQUATION_RGB),G=e.getParameter(e.BLEND_EQUATION_ALPHA),p=e.getParameter(e.VIEWPORT),x=e.getParameter(e.MAX_VIEWPORT_DIMS),h=e.getParameter(e.SCISSOR_TEST),w=e.getParameter(e.SCISSOR_BOX),y=e.getParameter(e.POLYGON_OFFSET_FILL),V=e.getParameter(e.POLYGON_OFFSET_FACTOR),H=e.getParameter(e.POLYGON_OFFSET_UNITS),W=e.getParameter(e.DITHER),v=e.getParameter(e.RED_BITS),Y=e.getParameter(e.GREEN_BITS),K=e.getParameter(e.BLUE_BITS),k=e.getParameter(e.ALPHA_BITS),z=e.getParameter(e.SUBPIXEL_BITS),Q=e.getParameter(e.ALIASED_LINE_WIDTH_RANGE),Z=e.getParameter(e.ALIASED_POINT_SIZE_RANGE),j=e.getParameter(e.COLOR_WRITEMASK),q=e.getParameter(e.COLOR_CLEAR_VALUE),J=e.getParameter(e.ACTIVE_TEXTURE),$=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),ee=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),te=e.getParameter(e.MAX_TEXTURE_SIZE),Ee=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),re=e.getParameter(e.MAX_RENDERBUFFER_SIZE),_e=e.getParameter(e.MAX_VERTEX_ATTRIBS),Te=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),ae=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),ne=e.getParameter(e.MAX_VARYING_VECTORS),Ae=e.getParameter(e.PACK_ALIGNMENT),Re=e.getParameter(e.UNPACK_ALIGNMENT),oe=e.getParameter(e.UNPACK_COLORSPACE_CONVERSION_WEBGL),ie=e.getParameter(e.UNPACK_FLIP_Y_WEBGL),Se=e.getParameter(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL),se=e.getParameter(e.VENDOR),Ne=e.getParameter(e.VERSION),Ie=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),ce=e.getParameter(e.CURRENT_PROGRAM),Ue=e.getParameter(e.ARRAY_BUFFER_BINDING),Pe=e.getParameter(e.ELEMENT_ARRAY_BUFFER_BINDING),Le=e.getParameter(e.FRAMEBUFFER_BINDING),fe=e.getParameter(e.RENDERBUFFER_BINDING),le=e.getParameter(e.TEXTURE_BINDING_2D),Ce=e.getParameter(e.TEXTURE_BINDING_CUBE_MAP),ue=e.getParameter(e.RENDERER),Oe=e.getParameter(e.SAMPLES),Be=e.getParameter(e.SAMPLE_BUFFERS),De=e.getParameter(e.SAMPLE_ALPHA_TO_COVERAGE),Me=e.getParameter(e.SAMPLE_COVERAGE_INVERT),de=e.getParameter(e.SAMPLE_COVERAGE_VALUE),Fe=e.getParameter(e.FRONT_FACE),me=e.getParameter(e.LINE_WIDTH),ge=e.getParameter(e.GENERATE_MIPMAP_HINT),Xe=e.getParameter(e.SHADING_LANGUAGE_VERSION);return{cullFace:{CULL_FACE:t,CULL_FACE_MODE:a[E]},depth:{DEPTH_TEST:r,DEPTH_CLEAR_VALUE:_,DEPTH_FUNC:a[T],DEPTH_WRITEMASK:n,DEPTH_RANGE:A,DEPTH_BITS:R},stencil:{STENCIL_TEST:o,STENCIL_CLEAR_VALUE:i,STENCIL_BITS:D,front:{STENCIL_REF:S,STENCIL_FUNC:a[s],STENCIL_FAIL:a[N],STENCIL_PASS_DEPTH_FAIL:a[I],STENCIL_PASS_DEPTH_PASS:a[c],STENCIL_VALUE_MASK:Number(U).toString(16),STENCIL_WRITEMASK:Number(P).toString(16)},back:{STENCIL_BACK_REF:L,STENCIL_BACK_FUNC:a[f],STENCIL_BACK_FAIL:a[l],STENCIL_BACK_PASS_DEPTH_FAIL:a[C],STENCIL_BACK_PASS_DEPTH_PASS:a[u],STENCIL_BACK_VALUE_MASK:Number(O).toString(16),STENCIL_BACK_WRITEMASK:Number(B).toString(16)}},blend:{BLEND:M,BLEND_COLOR:d,BLEND_DST_RGB:a[F],BLEND_DST_ALPHA:a[m],BLEND_SRC_RGB:a[g],BLEND_SRC_ALPHA:a[X],BLEND_EQUATION_RGB:a[b],BLEND_EQUATION_ALPHA:a[G]},viewport:{VIEWPORT:p,MAX_VIEWPORT_DIMS:x},scissor:{SCISSOR_TEST:h,SCISSOR_BOX:w},polygonOffset:{POLYGON_OFFSET_FILL:y,POLYGON_OFFSET_FACTOR:V,POLYGON_OFFSET_UNITS:H},DITHER:W,binding:{ARRAY_BUFFER_BINDING:Ue,ELEMENT_ARRAY_BUFFER_BINDING:Pe,CURRENT_PROGRAM:ce,FRAMEBUFFER_BINDING:Le,RENDERBUFFER_BINDING:fe,TEXTURE_BINDING_2D:le,TEXTURE_BINDING_CUBE:Ce},RENDERER:ue,color:{RED_BITS:v,GREEN_BITS:Y,BLUE_BITS:K,ALPHA_BITS:k,SUBPIXEL_BITS:z,COLOR_CLEAR_VALUE:q,COLOR_WRITEMASK:j},aliasedRange:{ALIASED_LINE_WIDTH_RANGE:Q,ALIASED_POINT_SIZE_RANGE:Z},texture:{MAX_TEXTURE_IMAGE_UNITS:$,MAX_COMBINED_TEXTURE_IMAGE_UNITS:ee,ACTIVE_TEXTURE:a[J],MAX_TEXTURE_SIZE:te,MAX_CUBE_MAP_TEXTURE_SIZE:Ee,MAX_RENDERBUFFER_SIZE:re},COMPRESSED_TEXTURE_FORMATS:Array.from(Ie).map((e=>a[e])),GENERATE_MIPMAP_HINT:a[ge],LINE_WIDTH:me,FRONT_FACE:a[Fe],SHADING_LANGUAGE_VERSION:Xe,vertex:{MAX_VERTEX_ATTRIBS:_e,MAX_VERTEX_TEXTURE_IMAGE_UNITS:Te,MAX_VERTEX_UNIFORM_VECTORS:ae,MAX_VARYING_VECTORS:ne},sample:{SAMPLES:Oe,SAMPLE_BUFFERS:Be,SAMPLE_ALPHA_TO_COVERAGE:De,SAMPLE_COVERAGE_VALUE:de,SAMPLE_COVERAGE_INVERT:Me},unpack:{PACK_ALIGNMENT:Ae,UNPACK_ALIGNMENT:Re,UNPACK_FLIP_Y_WEBGL:ie,UNPACK_PREMULTIPLY_ALPHA_WEBGL:Se,UNPACK_COLORSPACE_CONVERSION_WEBGL:a[oe]},VENDOR:se,VERSION:Ne}},clear:function(t,r){r=e(r,e.EMPTY_OBJECT);const{fb:_,color:T,depth:a,stencil:n}=r;t.bindFramebuffer(t.FRAMEBUFFER,_);let A=0;T&&(t.clearColor(T[0],T[1],T[2],T[3]),A|=t.COLOR_BUFFER_BIT),E(a)&&(t.clearDepth(a),A|=t.DEPTH_BUFFER_BIT),n&&(t.clearStencil(n),A|=t.STENCIL_BUFFER_BIT),0!==A&&t.clear(A)},draw:function(t,r){const{attributes:_,indices:T,vao:a,vs:n,fs:A,attributeLocations:R,fb:i}=r;let S=r.count;if(!E(S)&&E(T)&&(S=T.length),!E(S))throw new Error("vertices count or indices is not defined.");if(E(a)&&!E(R))throw new Error("To use vao, you must defined attributeLocations.");const f=e(r.primitiveType,t.TRIANGLES),l=e(r.uniforms,e.EMPTY_OBJECT);t.bindFramebuffer(t.FRAMEBUFFER,i);const C=n+A;let u=I[C];u||(u=function(e,t,r,_){const T=e.createShader(e.VERTEX_SHADER);e.shaderSource(T,t),e.compileShader(T);const a=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(a,r),e.compileShader(a);const n=e.createProgram();if(e.attachShader(n,T),e.attachShader(n,a),e.deleteShader(T),e.deleteShader(a),E(_))for(const t in _)if(Object.hasOwnProperty.call(_,t)){const E=_[t];e.bindAttribLocation(n,E,t)}e.linkProgram(n);let A="";return e.getProgramParameter(n,e.LINK_STATUS)||(e.getShaderParameter(a,e.COMPILE_STATUS)||(A=e.getShaderInfoLog(a),console.error("Fragment shader failed to compiled: "+A)),e.getShaderParameter(T,e.COMPILE_STATUS)||(A=e.getShaderInfoLog(T),console.error("Vertex shader failed to compiled: "+A)),A=e.getProgramInfoLog(n),console.error("Shader program link log: "+A)),n}(t,n,A,R),I[C]=u),t.useProgram(u);const O=t.getProgramParameter(u,t.ACTIVE_ATTRIBUTES);if(E(a))t.bindVertexArray(a);else{if(!E(_))throw new Error("vao or attributes must be defined.");{const e=function(e,t){let E="";for(const t in e)Object.hasOwnProperty.call(e,t)&&(E+=e[t].toString());return t&&(E+=t.toString()),E}(_,T);let E=L[e];if(!E){const r={};for(let e=0;e<O;e++){const E=t.getActiveAttrib(u,e),T=E.name;if(Object.hasOwnProperty.call(_,T)){const e=_[T],a=t.getAttribLocation(u,T);if(-1===a)continue;const n=P(E);r[T]={location:a,size:n,data:e}}}E=N(t,{attributes:r,indices:T}),L[e]=E}t.bindVertexArray(E)}}const B=t.getProgramParameter(u,t.ACTIVE_UNIFORMS),D=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);let M=0;for(let e=0;e<B;e++){const E=t.getActiveUniform(u,e);let r=E.name;const _=E.type;let T=!1;const a=r.indexOf("[");if(a>=0&&(r=r.slice(0,a),T=!0),Object.hasOwnProperty.call(l,r)){const e=l[r],a=t.getUniformLocation(u,r);if(null===a)continue;if(T){const E=U(_);t["uniform"+E+"fv"](a,Array.from(e));continue}const n=typeof e,A=t.TEXTURE0+M;if(e instanceof WebGLTexture){if(t.activeTexture(A),E.type===t.SAMPLER_2D)t.bindTexture(t.TEXTURE_2D,e);else if(E.type===t.SAMPLER_3D)t.bindTexture(t.TEXTURE_3D,e);else{if(E.type!==t.SAMPLER_CUBE)throw new Error(E,"type MUST be SAMPLER_2D or SAMPLER_CUBE");t.bindTexture(t.TEXTURE_CUBE_MAP,e)}t.uniform1i(a,M),M++}else if(d=e,Array.isArray(d)||d&&"object"==typeof d&&"number"==typeof d.length&&(0===d.length||d.length>0&&d.length-1 in d)){const E=e.length;if(E<=4)t["uniform"+E+"fv"](a,e);else if(E<=16){const r=Math.floor(Math.sqrt(E)),_=!1;t["uniformMatrix"+r+"fv"](a,_,Array.from(e))}}else if(_===t.FLOAT)t.uniform1f(a,e);else if(_===t.BOOL||_===t.INT)t.uniform1i(a,e);else if("string"===n){if(M>D){console.error("texture exceed maximum texture units.");continue}let E=c[e];if(!E){E=t.createTexture(),t.activeTexture(A),t.bindTexture(t.TEXTURE_2D,E),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([255,255,255,255]));const r=new Image;r.src=e,r.addEventListener("load",(()=>{t.activeTexture(A),t.bindTexture(t.TEXTURE_2D,E),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)})),c[e]=E}t.activeTexture(A),t.bindTexture(t.TEXTURE_2D,E),t.uniform1i(a,M),M++}}}var d;const F=t.getParameter(t.ELEMENT_ARRAY_BUFFER_BINDING);if(T&&T.length>0){const e=s(t,T,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e);const E=o(T);t.drawElements(f,S,E,0)}else if(F){const e=F.indicesType;t.drawElements(f,S,e,0)}else t.drawArrays(f,0,S)},createTexture:function(t,E){const{internalFormat:r,type:_,format:T,width:a,height:n,data:R,generateMipmap:o}=E,i=e(E.depth,1),S=e(E.wrapS,t.CLAMP_TO_EDGE),s=e(E.wrapT,t.CLAMP_TO_EDGE),N=e(E.wrapR,t.CLAMP_TO_EDGE),I=e(E.minFilter,t.LINEAR),c=e(E.magFilter,t.LINEAR);let U=E.levels;U||(U=[R]);const P=e(E.flipY,!1),L=e(E.premultiplyAlpha,!1);t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,P),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,L);const f=t.createTexture(),l=e(E.target,t.TEXTURE_2D);t.activeTexture(t.TEXTURE0),t.bindTexture(l,f),_===t.FLOAT&&(t instanceof WebGLRenderingContext&&!t._textureFloat&&console.warn("Do not support float texture."),I!==t.LINEAR&&I!==t.LINEAR_MIPMAP_NEAREST&&I!==t.NEAREST_MIPMAP_LINEAR&&I!==t.LINEAR_MIPMAP_LINEAR||t._textureFloatLinear||console.warn("Do not support float texture linear filter."));const C=U.length;for(let e=0;e<C;e++){const E=U[e];if(E instanceof HTMLImageElement||E instanceof HTMLCanvasElement||E instanceof HTMLVideoElement)l===t.TEXTURE_2D?t.texImage2D(t.TEXTURE_2D,e,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,E):t.TEXTURE_3D;else{const A=0;l===t.TEXTURE_2D?t.texImage2D(t.TEXTURE_2D,e,r,a,n,A,T,_,E):l===t.TEXTURE_3D&&(t.texImage3D(t.TEXTURE_3D,e,r,a,n,i,A,T,_,E),t.texParameteri(l,t.TEXTURE_WRAP_R,N))}}return t.texParameteri(l,t.TEXTURE_WRAP_S,S),t.texParameteri(l,t.TEXTURE_WRAP_T,s),t.texParameteri(l,t.TEXTURE_MIN_FILTER,I),t.texParameteri(l,t.TEXTURE_MAG_FILTER,c),!0===o&&(A(a)&&A(n)||t instanceof WebGL2RenderingContext?t.generateMipmap(l):console.warn("createTexture: texture size is NOT power of two, current is "+a+"x"+n+".")),t.bindTexture(l,null),f},updateTexture:function(t,E,r){if(t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,E),r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement)t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,videoElem);else{const{width:E,height:_,arrayBufferView:T}=r,a=e(r.level,0),n=e(r.internalFormat,t.RGBA),A=e(r.format,t.RGBA),R=e(r.internalFormat,t.UNSIGNED_BYTE),o=0;t.texImage2D(t.TEXTURE_2D,a,n,E,_,o,A,R,T)}return t.bindTexture(t.TEXTURE_2D,null),E},createCubeMap:function(t,E){E=e(E,e.EMPTY_OBJECT);const r=e(E.level,0),_=E.data,T=E.width,a=E.height,n=e(E.format,t.RGBA),A=e(E.type,t.UNSIGNED_BYTE),R=e(E.internalFormat,t.RGBA),o=t.createTexture();t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_CUBE_MAP,o);const i=[{target:t.TEXTURE_CUBE_MAP_POSITIVE_X,data:_.px},{target:t.TEXTURE_CUBE_MAP_NEGATIVE_X,data:_.nx},{target:t.TEXTURE_CUBE_MAP_POSITIVE_Y,data:_.py},{target:t.TEXTURE_CUBE_MAP_NEGATIVE_Y,data:_.ny},{target:t.TEXTURE_CUBE_MAP_POSITIVE_Z,data:_.pz},{target:t.TEXTURE_CUBE_MAP_NEGATIVE_Z,data:_.nz}];for(let e=0;e<6;e++){const E=i[e],_=E.target,o=E.data;o instanceof HTMLImageElement?t.texImage2D(_,r,R,n,A,o):t.texImage2D(_,r,R,T,a,0,n,A,o),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR)}return t.bindTexture(t.TEXTURE_CUBE_MAP,null),o},createVAO:N,createFramebuffer:function(t,E){const{colorTexture:r,depthTexture:_,depthRenderbuffer:T}=E,a=e(E.colorAttachments,[r]),A=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,A),t.activeTexture(t.TEXTURE0);const R=a.length;if(R>1){const e=t.getExtension("WebGL_draw_buffers"),E=[];for(let t=0;t<R;t++)E.push(e.COLOR_ATTACHMENT0_WEBGL+t);e.drawBuffersWEBGL(E);for(let e=0;e<R;e++){const E=a[e];t.bindTexture(t.TEXTURE_2D,E),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,E,0)}}else t.bindTexture(t.TEXTURE_2D,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);if(t.bindTexture(t.TEXTURE_2D,null),_)t.bindTexture(t.TEXTURE_2D,_),t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,_,0),t.bindTexture(t.TEXTURE_2D,null);else if(T){const e=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,e),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,T.width,T.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e),t.bindRenderbuffer(t.RENDERBUFFER,null)}const o=t.checkFramebufferStatus(t.FRAMEBUFFER);if(o!==t.FRAMEBUFFER_COMPLETE)throw new Error("createFramebuffer: framebuffer combination is NOT completed! Current status is "+n[o]+".");return A}}}));
//# sourceMappingURL=toygl.min.js.map
